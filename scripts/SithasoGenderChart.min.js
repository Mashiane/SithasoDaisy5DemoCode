class SithasoGenderChart extends HTMLElement{static get observedAttributes(){return[]}constructor(){super(),this.animations=[],this.timers=[],this.femaleSvgData=null,this.maleSvgData=null,this.femaleHeight=0,this.maleHeight=0,this.femaleWidth=0,this.maleWidth=0,this.data=null,this._dataType=this.getAttribute("type")||null,this._duration=null,this._waves="true"===this.getAttribute("waves"),this._waveSpeed=parseFloat(this.getAttribute("wave-speed"))||.09,this.femaleXOffset=0,this.maleXOffset=0,this.femaleTargetLevel=0,this.maleTargetLevel=0,this.femaleCurrentLevel=0,this.maleCurrentLevel=0,this.waveAnimationId=null,this._fillAnimationId=null,this._entryTimeoutId=null}get femaleValue(){return this.data?this.data[0].value:null}set femaleValue(t){this.data&&(this.data[0].value=parseFloat(t))}get maleValue(){return this.data?this.data[1].value:null}set maleValue(t){this.data&&(this.data[1].value=parseFloat(t))}get femaleTarget(){return this.data?this.data[0].target:null}set femaleTarget(t){this.data&&(this.data[0].target=parseFloat(t))}get maleTarget(){return this.data?this.data[1].target:null}set maleTarget(t){this.data&&(this.data[1].target=parseFloat(t))}get femaleLabel(){return this.data?this.data[0].name:null}set femaleLabel(t){this.data&&(this.data[0].name=t)}get maleLabel(){return this.data?this.data[1].name:null}set maleLabel(t){this.data&&(this.data[1].name=t)}get femaleColor(){return this.data?this.data[0].color:null}set femaleColor(t){this.data&&(this.data[0].color=t)}get maleColor(){return this.data?this.data[1].color:null}set maleColor(t){this.data&&(this.data[1].color=t)}get currentFemalePercent(){return this.data&&this.data[0].target?"percentages"===this.dataType?this.data[0].value:this.data[0].value/this.data[0].target*100:0}get currentMalePercent(){return this.data&&this.data[1].target?"percentages"===this.dataType?this.data[1].value:this.data[1].value/this.data[1].target*100:0}get dataType(){return this._dataType}set dataType(t){this._dataType!==t&&(this._dataType=t,this.getAttribute("type")!==t&&this.setAttribute("type",t))}get waves(){return this._waves}set waves(t){const e=!!t;this._waves!==e&&(this._waves=e,String(this.getAttribute("waves"))!==String(e)&&this.setAttribute("waves",e))}get waveSpeed(){return this._waveSpeed}set waveSpeed(t){const e=parseFloat(t)||.09;this._waveSpeed!==e&&(this._waveSpeed=e,parseFloat(this.getAttribute("wave-speed"))!==e&&this.setAttribute("wave-speed",e))}get duration(){return this._duration}set duration(t){this._duration=parseFloat(t)}get isAnimating(){return null!==this.waveAnimationId||this.timers.length>0}get femalePercent(){if(!this.data||!this.data[0].target)return 0;const t="percentages"===this.dataType?this.data[0].value/100:this.data[0].value/this.data[0].target;return Math.max(0,Math.min(1,t))}get malePercent(){if(!this.data||!this.data[1].target)return 0;const t="percentages"===this.dataType?this.data[1].value/100:this.data[1].value/this.data[1].target;return Math.max(0,Math.min(1,t))}disconnectedCallback(){this.stop()}start(){this.stop();const t=1e3;this._entryTimeoutId=setTimeout(()=>{this._entryTimeoutId=null,this.animate(this.data,this.dataType,this.duration)},t)}stop(){if(this.animations.forEach(t=>t.unschedule()),this.waveAnimationId&&(cancelAnimationFrame(this.waveAnimationId),this.waveAnimationId=null),this._fillAnimationId&&(cancelAnimationFrame(this._fillAnimationId),this._fillAnimationId=null),this._entryTimeoutId&&(clearTimeout(this._entryTimeoutId),this._entryTimeoutId=null),this.femaleXOffset=0,this.maleXOffset=0,this.femaleSvgData&&this.femaleSvgData.pathElement){const t=this.femaleSvgData.pathElement;t&&t.setAttribute("d",this.generateWavePath(this.femaleHeight,this.femaleWidth,0,this.femaleHeight))}if(this.maleSvgData&&this.maleSvgData.pathElement){const t=this.maleSvgData.pathElement;t&&t.setAttribute("d",this.generateWavePath(this.maleHeight,this.maleWidth,0,this.maleHeight))}this.timers.forEach(t=>clearInterval(t));const t=this.querySelector(".female-count"),e=this.querySelector(".male-count");t&&(t.textContent="0"),e&&(e.textContent="0"),this.animations=[],this.timers=[]}updateDisplay(){if(!this.data||!this.femaleSvgData||!this.maleSvgData)return;const t="percentages"===this.dataType?this.data[0].value/100:this.data[0].value/this.data[0].target,e="percentages"===this.dataType?this.data[1].value/100:this.data[1].value/this.data[1].target,a=(Math.max(0,Math.min(1,t)),Math.max(0,Math.min(1,e)),this.querySelector(".female-count")),i=this.querySelector(".male-count");a&&(a.textContent="percentages"===this.dataType?Math.floor(this.data[0].value)+"%":Math.floor(this.data[0].value).toLocaleString()),i&&(i.textContent="percentages"===this.dataType?Math.floor(this.data[1].value)+"%":Math.floor(this.data[1].value).toLocaleString())}draw(){this.updateDisplay()}animateCount(t,e,a,i){let s=0;const l=e/(a/50),r=setInterval(()=>{s+=l,s>=e&&(s=e,clearInterval(r)),t.textContent=i?Math.floor(s)+"%":Math.floor(s).toLocaleString()},50);return r}generateWavePath(t,e,a,i){const s="number"==typeof i?i:Math.max(this.femaleHeight,this.maleHeight,100),l=.015,r=5;let h=`M0,${t}`;const n=e>0?20/e:1;for(let i=0;i<=e;i+=n){const e=-Math.sin(i*l+a)*r;h+=` L${i},${t+e}`}return h+=` L${e},${s} L0,${s} Z`,h}async loadSVG(t,e,a){try{const i=await fetch(t);if(!i.ok)throw new Error(`Failed to load ${t}`);const s=await i.text();e.innerHTML=s;const l=e.querySelector("svg");if(!l)throw new Error(`No SVG found in ${t}`);l.style.width="100%",l.style.height="auto";let r=l.querySelector("defs");r||(r=document.createElementNS("http://www.w3.org/2000/svg","defs"),l.insertBefore(r,l.firstChild));let h=0,n=0;const o=l.getAttribute("viewBox");if(o){const t=o.split(/\s+|,/).map(Number);4===t.length&&(h=t[2],n=t[3])}h&&n||(h=parseFloat(l.getAttribute("width"))||l.clientWidth||100,n=parseFloat(l.getAttribute("height"))||l.clientHeight||100);const m=l.querySelector("path");if(!m)throw new Error("No path element found in SVG");const d=`${Math.random().toString(36).substr(2,9)}`,u=`grad-${d}`,g=`clip-${d}`,c=(t,e=.6)=>{if("string"==typeof t&&t.startsWith("#")){const a=parseInt(t.slice(1,3),16),i=parseInt(t.slice(3,5),16),s=parseInt(t.slice(5,7),16),l=Math.floor(a*e),r=Math.floor(i*e),h=Math.floor(s*e);return`rgb(${l},${r},${h})`}return t},v=c(a),f=document.createElementNS("http://www.w3.org/2000/svg","linearGradient");f.setAttribute("id",u),f.setAttribute("x1","0%"),f.setAttribute("y1","0%"),f.setAttribute("x2","0%"),f.setAttribute("y2","100%");const p=document.createElementNS("http://www.w3.org/2000/svg","stop");p.setAttribute("offset","0%"),p.setAttribute("stop-color",a);const b=document.createElementNS("http://www.w3.org/2000/svg","stop");b.setAttribute("offset","100%"),b.setAttribute("stop-color",v),f.appendChild(p),f.appendChild(b),r.appendChild(f);const w=document.createElementNS("http://www.w3.org/2000/svg","clipPath");w.setAttribute("id",g);const A=document.createElementNS("http://www.w3.org/2000/svg","path");A.setAttribute("d",this.generateWavePath(n,h,0,n)),w.appendChild(A),r.appendChild(w);const S=m.cloneNode(!0);S.setAttribute("fill",`url(#${u})`),S.setAttribute("clip-path",`url(#${g})`),m.parentNode.insertBefore(S,m),m.setAttribute("stroke","gray"),m.setAttribute("stroke-width",4),m.setAttribute("fill","none");let y=e.querySelector(".sithaso-svg-wrapper");return y||(y=document.createElement("div"),y.className="sithaso-svg-wrapper",y.style.overflow="visible",y.style.display="inline-block",e.insertBefore(y,l),y.appendChild(l)),y.style.transform="translateX(0)",y.style.transition="",{clipPath:w,pathElement:A,svgHeight:n,svgWidth:h,svg:l,gradient:f,outlinePath:m,fillPath:S,wrapper:y}}catch(t){return console.error("Error loading SVG:",t),e.innerHTML='<div style="color: red; text-align: center; padding: 10px;">Error loading icon</div>',null}}async loadSVGs(t){const e=t[0],a=t[1],i=this.querySelector(".female-container"),s=this.querySelector(".male-container"),l=await this.loadSVG(e.svg,i,e.color),r=await this.loadSVG(a.svg,s,a.color);return!(!l||!r)&&(this.femaleSvgData=l,this.maleSvgData=r,this.femaleHeight=l.svgHeight,this.maleHeight=r.svgHeight,this.femaleWidth=l.svgWidth,this.maleWidth=r.svgWidth,this.femaleCurrentLevel=this.femaleHeight,this.maleCurrentLevel=this.maleHeight,!0)}async animate(t,e,a){const i=t[0],s=t[1];let l,r;"percentages"===e?(l=i.value/100,r=s.value/100):(l=i.value/i.target,r=s.value/s.target),l=Math.max(0,Math.min(1,l)),r=Math.max(0,Math.min(1,r)),this.femaleTargetLevel=this.femaleHeight-this.femaleHeight*l,this.maleTargetLevel=this.maleHeight-this.maleHeight*r,this.femaleCurrentLevel=this.femaleHeight,this.maleCurrentLevel=this.maleHeight;const h=Date.now(),n=()=>{const t=Date.now()-h,l=Math.min(t/a,1);if(this.femaleCurrentLevel=this.femaleHeight-(this.femaleHeight-this.femaleTargetLevel)*l,this.maleCurrentLevel=this.maleHeight-(this.maleHeight-this.maleTargetLevel)*l,this.femaleSvgData&&this.femaleSvgData.pathElement){const t=this.femaleSvgData.pathElement;t.setAttribute("d",this.generateWavePath(this.femaleCurrentLevel,this.femaleWidth,0,this.femaleHeight))}if(this.maleSvgData&&this.maleSvgData.pathElement){const t=this.maleSvgData.pathElement;t.setAttribute("d",this.generateWavePath(this.maleCurrentLevel,this.maleWidth,0,this.maleHeight))}const r=this.querySelector(".female-count"),o=this.querySelector(".male-count"),m=i.value*l,d=s.value*l;r&&(r.textContent="percentages"===e?Math.floor(m)+"%":Math.floor(m).toLocaleString()),o&&(o.textContent="percentages"===e?Math.floor(d)+"%":Math.floor(d).toLocaleString()),l<1?this._fillAnimationId=requestAnimationFrame(n):(this._fillAnimationId=null,r&&(r.textContent="percentages"===e?Math.floor(i.value)+"%":i.value.toLocaleString()),o&&(o.textContent="percentages"===e?Math.floor(s.value)+"%":s.value.toLocaleString()),this.waves&&this.startWaveAnimation())};this._fillAnimationId=requestAnimationFrame(n)}startWaveAnimation(){if(!this.waves||!this.femaleSvgData||!this.maleSvgData)return;const t=()=>{if(this.femaleXOffset+=this.waveSpeed,this.maleXOffset+=this.waveSpeed,this.femaleSvgData&&this.femaleSvgData.pathElement){const t=this.femaleSvgData.pathElement;t.setAttribute("d",this.generateWavePath(this.femaleCurrentLevel,this.femaleWidth,this.femaleXOffset,this.femaleHeight))}if(this.maleSvgData&&this.maleSvgData.pathElement){const t=this.maleSvgData.pathElement;t.setAttribute("d",this.generateWavePath(this.maleCurrentLevel,this.maleWidth,this.maleXOffset,this.maleHeight))}this.waveAnimationId=requestAnimationFrame(t)};t()}async loadAndAnimate(t,e,a){await this.loadSVGs(t)&&await this.animate(t,e,a)}async connectedCallback(){this.style.width||(this.style.width="400px"),this.style.height||(this.style.height="400px");const t=this.getAttribute("type")||"numbers",e=parseFloat(this.getAttribute("female-value"))||0,a=parseFloat(this.getAttribute("male-value"))||0,i=parseFloat(this.getAttribute("female-target"))||e,s=parseFloat(this.getAttribute("male-target"))||a,l=this.getAttribute("female-color")||"deeppink",r=this.getAttribute("male-color")||"blue",h=parseFloat(this.getAttribute("duration"))||5e3,n=this.getAttribute("female-label")||"Female",o=this.getAttribute("male-label")||"Male",m=this.getAttribute("female-class")||"",d=this.getAttribute("male-class")||"",u=this.getAttribute("female-style")||"",g=this.getAttribute("male-style")||"",c="false"!==this.getAttribute("autoplay"),v=[{name:n,value:e,target:i,svg:this.getAttribute("female-svg")||"female.svg",color:l},{name:o,value:a,target:s,svg:this.getAttribute("male-svg")||"male.svg",color:r}];this.data=v,this.dataType=t,this.duration=h,this.innerHTML=`\n      <div class="grid grid-cols-2 gap-4 p-4 md:p-8" style="width: 100%; height: 100%; position: relative;">\n        <div class="card bg-base-100 shadow-xl female-card" role="button" tabindex="0" aria-label="${n}: ${e}${"percentages"===t?"%":""}">\n          <div class="card-body items-center text-center">\n            <h2 class="card-title">${n}</h2>\n            <div class="female-container ${m}" style="${u}; position: relative;"></div>\n            <p class="text-lg font-semibold female-count">0</p>\n          </div>\n        </div>\n        <div class="card bg-base-100 shadow-xl male-card" role="button" tabindex="0" aria-label="${o}: ${a}${"percentages"===t?"%":""}">\n          <div class="card-body items-center text-center">\n            <h2 class="card-title">${o}</h2>\n            <div class="male-container ${d}" style="${g}; position: relative;"></div>\n            <p class="text-lg font-semibold male-count">0</p>\n          </div>\n        </div>\n      </div>\n    `,this.setAttribute("female-visible",this.getAttribute("female-visible")||"true"),this.setAttribute("male-visible",this.getAttribute("male-visible")||"true"),await this.loadSVGs(v),this.updateDisplay(),c&&this.start()}}customElements.define("sithaso-gender-chart",SithasoGenderChart);