if(!document.getElementById("daisy-multiselect-styles")){const e=document.createElement("style");e.id="daisy-multiselect-styles",e.textContent='\n    /* CRITICAL: Override DaisyUI menu-active globally for entire component */\n    daisy-multiselect .menu-active,\n    daisy-multiselect li.menu-active,\n    daisy-multiselect .menu li:active,\n    daisy-multiselect .menu li:focus,\n    daisy-multiselect .menu-vertical li:active,\n    daisy-multiselect .menu-vertical li:focus {\n      background-color: transparent !important;\n      background: transparent !important;\n      color: inherit !important;\n    }\n    \n    /* Additional custom styles for the multi-select */\n    .multiselect-dropdown {\n      max-height: 300px;\n      overflow-y: auto;\n    }\n    \n    /* Prevent text flicker during updates */\n    .multiselect-display {\n      user-select: none;\n      -webkit-user-select: none;\n      backface-visibility: hidden;\n      -webkit-font-smoothing: subpixel-antialiased;\n      transform: translateZ(0); /* Force GPU acceleration */\n      contain: layout style; /* Isolate from external layout changes */\n    }\n    \n    /* Disabled state border */\n    .multiselect-trigger.input-disabled {\n      border-color: rgba(0, 0, 0, 0.1);\n      border-width: 1px;\n      border-style: solid;\n    }\n    \n    .multiselect-option {\n      cursor: pointer;\n      transition: background-color 0.15s ease-out;\n    }\n    \n    /* Prevent text content from transitioning/fading during selection */\n    .multiselect-option * {\n      transition: none !important;\n    }\n    \n    /* Re-enable transition only for checkbox */\n    .multiselect-option input[type="checkbox"] {\n      transition: none !important;\n    }\n    \n    /* Completely override ALL DaisyUI menu active/focus states */\n    .multiselect-option:focus,\n    .multiselect-option:focus-visible,\n    .multiselect-option:focus-within,\n    .multiselect-option:active,\n    .multiselect-option.active,\n    .multiselect-option.menu-active,\n    .multiselect-option[aria-pressed="true"],\n    li.multiselect-option:focus,\n    li.multiselect-option:focus-visible,\n    li.multiselect-option:focus-within,\n    li.multiselect-option:active,\n    .menu li.multiselect-option:focus,\n    .menu li.multiselect-option:active,\n    .menu-vertical li.multiselect-option:focus,\n    .menu-vertical li.multiselect-option:active {\n      background-color: transparent !important;\n      background: transparent !important;\n      color: inherit !important;\n      outline: none !important;\n      box-shadow: none !important;\n    }\n    \n    /* Override DaisyUI menu internal opacity/color changes on child elements */\n    /* Exclude checkbox to preserve its checked color */\n    .multiselect-option:focus *:not(input[type="checkbox"]),\n    .multiselect-option:focus-visible *:not(input[type="checkbox"]),\n    .multiselect-option:active *:not(input[type="checkbox"]),\n    .multiselect-option.active *:not(input[type="checkbox"]),\n    .multiselect-option.menu-active *:not(input[type="checkbox"]),\n    li.multiselect-option:focus *:not(input[type="checkbox"]),\n    li.multiselect-option:active *:not(input[type="checkbox"]),\n    .menu li.multiselect-option:focus *:not(input[type="checkbox"]),\n    .menu li.multiselect-option:active *:not(input[type="checkbox"]),\n    .menu-vertical li.multiselect-option:focus *:not(input[type="checkbox"]),\n    .menu-vertical li.multiselect-option:active *:not(input[type="checkbox"]) {\n      opacity: 1 !important;\n      color: inherit !important;\n      background: transparent !important;\n    }\n    \n    .multiselect-option:hover:not(.disabled) {\n      background-color: var(--color-base-200);\n    }\n    \n    .multiselect-option.selected.highlight {\n      background-color: var(--color-primary);\n      color: var(--color-primary-content);\n    }\n    \n    /* Color variants for selected items with highlight */\n    .multiselect-option.selected.highlight.color-secondary {\n      background-color: var(--color-secondary);\n      color: var(--color-secondary-content);\n    }\n    \n    .multiselect-option.selected.highlight.color-accent {\n      background-color: var(--color-accent);\n      color: var(--color-accent-content);\n    }\n    \n    .multiselect-option.selected.highlight.color-success {\n      background-color: var(--color-success);\n      color: var(--color-success-content);\n    }\n    \n    .multiselect-option.selected.highlight.color-warning {\n      background-color: var(--color-warning);\n      color: var(--color-warning-content);\n    }\n    \n    .multiselect-option.selected.highlight.color-error {\n      background-color: var(--color-error);\n      color: var(--color-error-content);\n    }\n    \n    .multiselect-option.selected.highlight.color-info {\n      background-color: var(--color-info);\n      color: var(--color-info-content);\n    }\n    \n    .multiselect-option.selected.highlight.color-neutral {\n      background-color: var(--color-neutral);\n      color: var(--color-neutral-content);\n    }\n    \n    /* Keyboard navigation focus state */\n    .multiselect-option.focused > div {\n      outline: 2px solid oklch(var(--p));\n      outline-offset: -2px;\n    }\n    \n    /* Clear button inside select */\n    .clear-btn-inner {\n      background: transparent;\n      border: none;\n      padding: 0.25rem;\n      cursor: pointer;\n      border-radius: 0.25rem;\n      display: inline-flex;\n      align-items: center;\n      justify-content: center;\n      flex-shrink: 0;\n    }\n    \n    .clear-btn-inner:hover {\n      background-color: rgba(0, 0, 0, 0.1);\n    }\n    \n    /* Ensure button maintains flex layout */\n    .multiselect-trigger {\n      display: flex !important;\n    }\n    \n    /* Show clear button on hover or when there are selections */\n    .multiselect-container:hover .clear-btn-inner.has-selections,\n    .clear-btn-inner.has-selections {\n      opacity: 0.6 !important;\n    }\n    \n    .multiselect-container:hover .clear-btn-inner.has-selections:hover {\n      opacity: 1 !important;\n    }\n\n    /* Performance optimizations */\n    .multiselect-container {\n      contain: layout style;\n    }\n\n    .multiselect-dropdown {\n      contain: layout style;\n      will-change: transform;\n    }\n\n    .chips-container {\n      contain: layout style;\n    }\n    \n    /* Hardware acceleration for smooth interactions */\n    .multiselect-option,\n    .badge,\n    .clear-btn-inner {\n      transform: translateZ(0);\n      backface-visibility: hidden;\n      -webkit-font-smoothing: subpixel-antialiased;\n    }\n    \n    /* Optimize checkbox transitions */\n    .multiselect-option input[type="checkbox"] {\n      transition: none; /* Remove transition for instant feedback */\n    }\n    \n    /* Smooth chip animations */\n    .badge {\n      transition: opacity 0.15s ease-out;\n    }\n\n   \n',document.head.appendChild(e)}class DaisyMultiSelect extends HTMLElement{static VALID_SIZES=["xs","sm","md","lg","xl"];static VALID_COLORS=["primary","secondary","accent","success","warning","error","info","neutral"];static DEFAULT_SIZE="md";static DEFAULT_COLOR="primary";static DEFAULT_VIRTUAL_SCROLL_THRESHOLD=50;static debounce(e,t){let i;return function(...s){clearTimeout(i),i=setTimeout(()=>e.apply(this,s),t)}}static throttle(e,t){let i=0;return function(...s){const n=Date.now();n-i>=t&&(i=n,e.apply(this,s))}}constructor(){super(),this._keysSelected={},this._valueDict={},this._isOpen=!1,this._optionIdCounter=0,this._updateDisplayPending=!1,this._abortController=new AbortController,this._selectedCount=0,this._cachedSelectedItems=[],this._selectedItemsDirty=!0,this._debug=!1,this._hooks={onSetupStart:[],onSetupComplete:[],onRenderStart:[],onRenderComplete:[],onOptionAdded:[],onOptionRemoved:[],onOptionUpdated:[],onSelectionChange:[]},this._customRenderer=null,this._valueField="value",this._textField="text",this._selectedField="selected",this._disabledField="disabled",this._extraDataFields=[]}static get observedAttributes(){return["class","style","checked-color"]}_handleError(e,t){console.error(`DaisyMultiSelect error in ${t}:`,e),this.dispatchEvent(new CustomEvent("error",{detail:{error:e,context:t,message:e.message},bubbles:!0,composed:!0})),this._triggerBtn&&"connectedCallback"!==t&&this._showErrorState(`An error occurred: ${e.message}`)}_showErrorState(e){if(!this._display)return;const t=`\n          <span class="text-error flex items-center gap-2">\n            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>\n            </svg>\n            <span class="text-sm">${e}</span>\n          </span>\n        `;this._display.innerHTML=t}_extractDataAttributes(e){const t={};return Array.from(e.attributes).forEach(e=>{if(e.name.startsWith("data-")){const i=e.name.slice(5).replace(/-([a-z])/g,e=>e[1].toUpperCase());t[i]=e.value}}),t}_log(e,...t){if(this._debug){const i=this.id||this.getAttribute("name")||"unnamed";console.log(`[MultiSelect#${i}] ${e}`,...t)}}connectedCallback(){this._debug=this.hasAttribute("debug")||this.hasAttribute("verbose"),this._log("Component connecting..."),this._placeholder=this.getAttribute("placeholder")||"Select options...",this._color=this.getAttribute("checked-color")||DaisyMultiSelect.DEFAULT_COLOR,this._isHexColor=this._color.startsWith("#"),this._chipTextColor=this.getAttribute("chip-text-color")||"",this._inputColor=this.getAttribute("input-color")||"",this._size=this.getAttribute("size")||DaisyMultiSelect.DEFAULT_SIZE,this._singleSelect=this.hasAttribute("single-select"),this._maxSelections=this._singleSelect?1:parseInt(this.getAttribute("max-selections"))||0,this._searchable=this.hasAttribute("searchable"),this._showSelectAll=this.hasAttribute("show-select-all"),this._showClear=!this.hasAttribute("hide-clear"),this._disabled=this.hasAttribute("disabled"),this._required=this.hasAttribute("required"),this._virtualScroll=this.hasAttribute("virtual-scroll"),this._virtualScrollThreshold=parseInt(this.getAttribute("virtual-scroll-threshold"))||DaisyMultiSelect.DEFAULT_VIRTUAL_SCROLL_THRESHOLD,this._delimiter=this.getAttribute("delimiter")||";",this._chipStyle=!this.hasAttribute("no-chip-style"),this._highlight=this.hasAttribute("highlight"),this._userClasses=this.className,this._userStyles=this.getAttribute("style")||"";try{(this._isHexColor||this._chipTextColor)&&this._applyHexColorStyles(),this._setupComponent(),this._setupEventHandlers(),this._setSelectedStates(),this._applyUserAttributes()}catch(e){console.error("Failed to initialize daisy-multiselect:",e),this.innerHTML='\n            <div class="alert alert-error">\n              <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24">\n                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />\n              </svg>\n              <span>Failed to initialize multi-select component</span>\n            </div>\n          '}}disconnectedCallback(){this._removeEventHandlers(),this._hexColorStyleElement&&this._hexColorStyleElement.remove()}attributeChangedCallback(e,t,i){this._triggerBtn&&("class"===e?(this._userClasses=i||"",this._applyUserAttributes()):"style"===e?(this._userStyles=i||"",this._applyUserAttributes()):"checked-color"===e&&(this._color=i||"primary",this._isHexColor=this._color.startsWith("#"),this._isHexColor?this._applyHexColorStyles():this._hexColorStyleElement&&(this._hexColorStyleElement.remove(),this._hexColorStyleElement=null),this._applyCheckedColorToOptions(),this._applyUserAttributes()))}_applyHexColorStyles(){this._hexColorStyleElement&&this._hexColorStyleElement.remove();const e=`hex-${Math.random().toString(36).substr(2,9)}`;this._hexColorClass=e;const t=this._chipTextColor||"white";this._hexColorStyleElement=document.createElement("style");let i="";this._isHexColor&&(i+=`\n          .${e} .checkbox:checked,\n          .${e} .checkbox[checked="true"],\n          .${e} .checkbox[aria-checked="true"] {\n            --chkbg: ${this._color};\n            --chkfg: white;\n            border-color: ${this._color};\n          }\n          `),this._isHexColor?i+=`\n          .badge-hex-${e} {\n            background-color: ${this._color};\n            color: ${t};\n            border-color: ${this._color};\n          }\n          `:this._chipTextColor&&(i+=`\n          .badge-hex-${e} {\n            color: ${t};\n          }\n          `),this._hexColorStyleElement.textContent=i,document.head.appendChild(this._hexColorStyleElement)}_getInputColorClass(){if(!this._inputColor)return"";return["neutral","primary","secondary","accent","info","success","warning","error"].includes(this._inputColor)?`input-${this._inputColor}`:""}_getSizeClass(){return["xs","sm","md","lg","xl"].includes(this._size)?`input-${this._size}`:"input-md"}_getMinHeightClass(){return{xs:"min-h-6",sm:"min-h-8",md:"min-h-10",lg:"min-h-12",xl:"min-h-14"}[this._size]||"min-h-10"}_getHeightClass(){return{xs:"h-6",sm:"h-8",md:"h-10",lg:"h-12",xl:"h-14"}[this._size]||"h-10"}_getCheckboxSizeClass(){return{xs:"checkbox-xs",sm:"checkbox-sm",md:"checkbox-md",lg:"checkbox-lg",xl:"checkbox-xl"}[this._size]||"checkbox-md"}_getTextSizeClass(){return{xs:"text-xs",sm:"text-sm",md:"text-base",lg:"text-lg",xl:"text-xl"}[this._size]||"text-base"}_getPaddingClass(){return{xs:"p-1",sm:"p-1.5",md:"p-2",lg:"p-2.5",xl:"p-3"}[this._size]||"p-2"}_renderOptionContent(e){if(this._customRenderer)try{return this._customRenderer(e)||`<span class="${this._getTextSizeClass()}">${this._escapeHtml(e.text)}</span>`}catch(t){return console.error("Error in customRenderer:",t),`<span class="${this._getTextSizeClass()}">${this._escapeHtml(e.text)}</span>`}return`<span class="${this._getTextSizeClass()}">${this._escapeHtml(e.text)}</span>`}_setupComponent(){this._log("Setting up component...");const e=Array.from(this.querySelectorAll("option"));this._log(`Found ${e.length} option elements`),this.innerHTML=`\n          <div class="relative w-full">\n            \x3c!-- Hidden Native Select --\x3e\n            <select multiple class="hidden" name="${this.getAttribute("name")||"multiselect"}">\n              ${e.map(e=>`\n                <option value="${e.value}" ${e.selected?"selected":""} ${e.disabled?"disabled":""}>\n                  ${e.textContent}\n                </option>\n              `).join("")}\n            </select>\n            \n            \x3c!-- Display Input --\x3e\n            <div class="multiselect-container flex flex-row items-center">\n              <button type="button" class="multiselect-trigger input input-bordered w-full text-left cursor-pointer !h-auto ${this._getMinHeightClass()} flex ${this._chipStyle?"flex-wrap gap-x-2 !p-1.5":"justify-between"} ${this._getInputColorClass()} ${this._getSizeClass()} ${this._disabled?"input-disabled cursor-not-allowed opacity-60":""}" ${this._disabled?"disabled":""} aria-haspopup="listbox" aria-expanded="false" aria-label="${this._placeholder}" role="combobox">\n                <span class="multiselect-display ${this._chipStyle?"flex-1 min-w-0":"flex-1 mr-2 py-1"}">${this._placeholder}</span>\n                <div class="flex items-center gap-2 flex-shrink-0">\n                  ${this._showClear?`\n                    <span class="multiselect-clear-btn clear-btn-inner opacity-0 hover:opacity-100 transition-opacity ${this._disabled?"hidden":""}" title="Clear all selections">\n                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>\n                      </svg>\n                    </span>\n                  `:""}\n                  <svg class="multiselect-caret w-5 h-5 transition-transform flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>\n                  </svg>\n                </div>\n              </button>              \n            </div>\n            \n            \x3c!-- Dropdown Content --\x3e\n            <div class="multiselect-dropdown-content dropdown-content menu bg-base-100 rounded-box z-50 w-full shadow-lg border border-base-300 hidden multiselect-dropdown absolute" role="listbox" aria-multiselectable="true" style="top: 100%; margin-top: 0.5rem; contain: layout style paint;">\n              <div class="p-2">\n                ${this._searchable?`\n                  <div class="mb-2">\n                    <input type="search" placeholder="Search..." class="multiselect-search-input input ${this._getSizeClass()} input-bordered w-full">\n                  </div>\n                `:""}\n                ${this._showSelectAll?`\n                  <div class="flex gap-2 mb-2">\n                    <button type="button" class="multiselect-select-all-btn btn ${this._getSizeClass().replace("input-","btn-")} btn-ghost flex-1">Select All</button>\n                    <button type="button" class="multiselect-deselect-all-btn btn ${this._getSizeClass().replace("input-","btn-")} btn-ghost flex-1">Deselect All</button>\n                  </div>\n                `:""}\n                <ul class="multiselect-options-list menu-vertical w-full ${this._isHexColor?this._hexColorClass:""}">\n                  ${e.map((e,t)=>{const i=this._extractDataAttributes(e),s=void 0!==i.selected?"true"===i.selected||!0===i.selected:e.selected,n=void 0!==i.disabled?"true"===i.disabled||!0===i.disabled:e.disabled,o={value:e.value,text:e.textContent,selected:s,disabled:n,index:t,...i};let l="";for(const[e,t]of Object.entries(i))if("selected"!==e&&"disabled"!==e){l+=` data-${e.replace(/[A-Z]/g,e=>`-${e.toLowerCase()}`)}="${t}"`}return`\n                    <li class="multiselect-option w-full ${n?"disabled opacity-50":""} active:!bg-transparent focus:!bg-transparent focus:outline-none" data-index="${t}" data-value="${e.value}" data-text="${e.textContent.toLowerCase()}"${l} role="option" aria-selected="${s?"true":"false"}" ${n?'aria-disabled="true"':""} tabindex="-1">\n                      <div class="flex items-center gap-3 cursor-pointer w-full ${this._getPaddingClass()} rounded ${n?"pointer-events-none":""} active:!bg-transparent active:scale-100">\n                        <input type="checkbox" class="checkbox ${this._getCheckboxColorClass()} ${this._getCheckboxSizeClass()} pointer-events-none" ${s?"checked":""} ${n?"disabled":""}>\n                        ${this._renderOptionContent(o)}\n                      </div>\n                    </li>\n                  `}).join("")}\n                </ul>\n                <div class="multiselect-no-results text-center text-sm opacity-60 hidden mt-2">No options found</div>\n              </div>\n            </div>\n          </div>\n        `,this._triggerBtn=this.querySelector(".multiselect-trigger"),this._dropdown=this.querySelector(".multiselect-dropdown-content"),this._display=this.querySelector(".multiselect-display"),this._caret=this.querySelector(".multiselect-caret"),this._nativeSelect=this.querySelector("select"),this._options=this.querySelectorAll(".multiselect-option"),this._clearBtn=this.querySelector(".multiselect-clear-btn"),this._caret&&(this._caret.style.willChange="transform"),this._dropdown&&(this._dropdown.style.willChange="opacity, transform"),this._display.addEventListener("click",e=>{const t=e.target.closest("[data-chip-remove]");if(t){e.preventDefault(),e.stopPropagation();const i=t.dataset.chipRemove;this._removeChip(i)}},{signal:this._abortController.signal}),e.forEach((e,t)=>{const i="option-"+this._optionIdCounter++,s=this._options[t];s.dataset.optionKey=i;const n=this._extractDataAttributes(e),o=void 0!==n.selected?"true"===n.selected||!0===n.selected:e.selected,l=void 0!==n.disabled?"true"===n.disabled||!0===n.disabled:e.disabled;this._valueDict[i]={value:e.value,text:e.textContent,selected:o,disabled:l,optionEl:s,nativeOption:this._nativeSelect.options[t],...n}}),this._virtualScroll&&e.length>this._virtualScrollThreshold&&this._setupVirtualScroll(),this._log("Component setup complete"),this._trigger("onSetupComplete",{optionCount:e.length})}_applyUserAttributes(){if(!this._triggerBtn)return;const e=["multiselect-trigger","input","input-bordered","w-full","text-left","cursor-pointer",this._getInputColorClass(),this._getSizeClass()];e.push("!h-auto",this._getMinHeightClass(),"flex"),this._chipStyle?e.push("flex-wrap","gap-x-2","!p-1.5"):e.push("justify-between"),this._disabled&&e.push("input-disabled","cursor-not-allowed","opacity-60");const t=this._userClasses?this._userClasses.split(/\s+/).filter(e=>e):[],i=[...e,...t].filter(e=>e);if(this._triggerBtn.className=i.join(" "),this._userStyles){this._userStyles.split(";").filter(e=>e.trim()).forEach(e=>{const[t,i]=e.split(":").map(e=>e.trim());t&&i&&(this._triggerBtn.style[t]=i)})}const s=Array.from(this.attributes),n=["placeholder","color","checked-color","input-color","size","max-selections","searchable","show-select-all","hide-clear","disabled","required","virtual-scroll","virtual-scroll-threshold","delimiter","name","class","style"];s.forEach(e=>{(e.name.startsWith("data-")||!n.includes(e.name)&&"id"!==e.name&&!e.name.startsWith("aria-"))&&this._triggerBtn.setAttribute(e.name,e.value)})}_applyCheckedColorToOptions(){try{const e=this._dropdown.querySelector(".multiselect-options-list");e&&(this._isHexColor?e.classList.add(this._hexColorClass):e.className=e.className.replace(/hex-\w+/g,"").trim());for(let e in this._valueDict){const t=this._valueDict[e];if(!t||!t.optionEl)continue;const i=t.optionEl.querySelector('input[type="checkbox"]');i&&(i.className=`checkbox ${this._getCheckboxColorClass()} ${this._getCheckboxSizeClass()} pointer-events-none`),this._keysSelected[e]?"primary"===this._color||this._isHexColor?t.optionEl.classList.remove(...Array.from(t.optionEl.classList).filter(e=>e.startsWith("color-"))):t.optionEl.classList.add(`color-${this._color}`):t.optionEl.classList.remove(...Array.from(t.optionEl.classList).filter(e=>e.startsWith("color-")))}}catch(e){console.error("Error applying checked color to options",e)}}_setupVirtualScroll(){this._virtualScrollEnabled=!0,this._itemHeight=40,this._visibleItems=Math.ceil(300/this._itemHeight),this._bufferItems=5,this._scrollTop=0;const e=this.querySelector(".multiselect-options-list"),t=this._dropdown;this._allOptions=Array.from(this._options),this._totalItems=this._allOptions.length;const i=this._totalItems*this._itemHeight;e.style.height=`${i}px`,e.style.position="relative",this._virtualScrollBound=this._handleVirtualScroll.bind(this),t.addEventListener("scroll",this._virtualScrollBound,{passive:!0,signal:this._abortController.signal}),this._renderVisibleItems()}_handleVirtualScroll(){this._scrollTop=this._dropdown.scrollTop,this._renderVisibleItems()}_renderVisibleItems(){if(!this._virtualScrollEnabled)return;const e=Math.max(0,Math.floor(this._scrollTop/this._itemHeight)-this._bufferItems),t=Math.min(this._totalItems,e+this._visibleItems+2*this._bufferItems);this._allOptions.forEach((i,s)=>{s<e||s>=t?i.style.display="none":(i.style.display="",i.style.position="absolute",i.style.top=s*this._itemHeight+"px",i.style.width="100%")})}_disableVirtualScroll(){if(!this._virtualScrollEnabled)return;this._allOptions.forEach(e=>{e.style.display="",e.style.position="",e.style.top=""});const e=this.querySelector(".multiselect-options-list");e.style.height="",e.style.position=""}_enableVirtualScroll(){if(!this._virtualScroll||this._totalItems<this._virtualScrollThreshold)return;this._scrollTop=this._dropdown.scrollTop;const e=this.querySelector(".multiselect-options-list"),t=this._totalItems*this._itemHeight;e.style.height=`${t}px`,e.style.position="relative",this._renderVisibleItems()}_setupEventHandlers(){const e=this._abortController.signal;this._toggleBound=this._toggleDropdown.bind(this),this._triggerBtn.addEventListener("click",this._toggleBound,{signal:e}),this._optionClickBound=this._handleOptionClickDelegated.bind(this);const t=this.querySelector(".multiselect-options-list");t&&t.addEventListener("click",this._optionClickBound,{signal:e});const i=this.querySelector(".multiselect-search-input");if(i){const t=DaisyMultiSelect.debounce(e=>{this._filterOptions(e)},150);i.addEventListener("input",e=>{t(e.target.value)},{signal:e}),i.addEventListener("click",e=>{e.stopPropagation()},{signal:e})}const s=this.querySelector(".multiselect-select-all-btn");s&&s.addEventListener("click",e=>{e.stopPropagation(),this.selectAll()},{signal:e});const n=this.querySelector(".multiselect-deselect-all-btn");n&&n.addEventListener("click",e=>{e.stopPropagation(),this.clearSelected()},{signal:e});const o=this.querySelector(".multiselect-clear-btn");o&&o.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),this.clearSelected()},{signal:e}),this._setupGlobalClickHandler(),this._keydownBound=this._handleKeydown.bind(this),this._triggerBtn.addEventListener("keydown",this._keydownBound,{signal:e})}_setupGlobalClickHandler(){window._multiselectGlobalClickHandler||(window._multiselectGlobalClickHandler=e=>{document.querySelectorAll("daisy-multiselect").forEach(t=>{t._isOpen&&!t.contains(e.target)&&t.close()})},document.addEventListener("click",window._multiselectGlobalClickHandler,{passive:!0})),this._usesGlobalClickHandler=!0}_removeEventHandlers(){try{this._abortController&&"function"==typeof this._abortController.abort&&this._abortController.abort()}catch(e){console.warn("Warning: _removeEventHandlers abort() failed",e)}try{this._abortController=new AbortController}catch(e){this._abortController=null}}_toggleDropdown(e){e.stopPropagation(),this._isOpen?this.close():this.open()}_positionDropdown(){this._triggerBtn&&this._dropdown&&requestAnimationFrame(()=>{const e=window.innerHeight,t=this._triggerBtn.getBoundingClientRect(),i=this._dropdown.offsetHeight,s=e-t.bottom,n=t.top;s<i&&n>s?(this._dropdown.style.bottom="100%",this._dropdown.style.top="auto",this._dropdown.style.marginTop="0",this._dropdown.style.marginBottom="0.5rem"):(this._dropdown.style.top="100%",this._dropdown.style.bottom="auto",this._dropdown.style.marginTop="0.5rem",this._dropdown.style.marginBottom="0")})}_handleKeydown(e){if("Escape"===e.key&&this._isOpen)e.preventDefault(),this.close();else if(!this._isOpen||"ArrowDown"!==e.key&&"ArrowUp"!==e.key)if(!this._isOpen||"Enter"!==e.key&&" "!==e.key)this._isOpen||"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),this.open());else{e.preventDefault();Array.from(this._options).find(e=>e.classList.contains("focused"))?this._selectFocusedOption():this.close()}else e.preventDefault(),this._navigateOptions("ArrowDown"===e.key?1:-1)}_handleOptionClickDelegated(e){try{const t=e.target.closest(".multiselect-option");if(!t||t.classList.contains("disabled"))return;e.preventDefault(),e.stopPropagation();const i=t.dataset.optionKey,s=t.querySelector('input[type="checkbox"]'),n=!s.checked;s.checked=n,this._toggleSelection(i)}catch(e){this._handleError(e,"_handleOptionClickDelegated")}}_handleOptionClick(e){e.preventDefault(),e.stopPropagation();const t=e.currentTarget,i=t.dataset.optionKey,s=t.querySelector('input[type="checkbox"]'),n=!s.checked;s.checked=n,this._toggleSelection(i)}_toggleSelection(e){const t=this._valueDict[e];if(!t||t.disabled)return;const i=!this._keysSelected[e];if(i&&this._maxSelections>0&&this._selectedCount>=this._maxSelections)return;i?(this._keysSelected[e]=!0,this._selectedCount++):(delete this._keysSelected[e],this._selectedCount--),this._selectedItemsDirty=!0;const s=t.checkbox||t.optionEl.querySelector('input[type="checkbox"]');t.checkbox||(t.checkbox=s),s.checked=i,t.optionEl.setAttribute("aria-selected",i?"true":"false");const n=t.optionEl.classList;i?(n.add("selected"),this._highlight&&n.add("highlight"),"primary"!==this._color&&n.add(`color-${this._color}`)):n.remove("selected","highlight",`color-${this._color}`),t.nativeOption.selected=i,this._updateDisplay(),this._trigger("onSelectionChange",{selectedCount:this._selectedCount,key:e,value:t.value,text:t.text,isSelected:i}),this._maxSelections>0&&this._scheduleMaxSelectionsUpdate()}_setSelectedStates(){this._keysSelected={},this._selectedCount=0,this._selectedItemsDirty=!0;for(let e in this._valueDict){const t=this._valueDict[e];if(t.selected){this._keysSelected[e]=!0,this._selectedCount++,t.optionEl.classList.add("selected"),this._highlight&&t.optionEl.classList.add("highlight"),"primary"!==this._color&&t.optionEl.classList.add(`color-${this._color}`);t.optionEl.querySelector('input[type="checkbox"]').checked=!0}}this._updateDisplay()}_updateDisplay(){this._display&&(this._updateDisplayPending||(this._updateDisplayPending=!0,queueMicrotask(()=>{this._updateDisplayPending=!1,this._performDisplayUpdate()})))}_performDisplayUpdate(){if(this._display){if(this._selectedItemsDirty){this._cachedSelectedItems=[];for(let e in this._keysSelected){const t=this._valueDict[e];t&&this._cachedSelectedItems.push({key:e,text:t.text,value:t.value})}this._selectedItemsDirty=!1}this._clearBtn&&(0===this._selectedCount?this._clearBtn.classList.remove("has-selections"):this._clearBtn.classList.add("has-selections")),this._chipStyle?this._renderChips(this._cachedSelectedItems):this._renderCommaList(this._cachedSelectedItems),this._updateBorderColor(),this._dispatchChangeEvent()}}_renderCommaList(e){if(0===e.length){const e=this._placeholder;this._display.textContent!==e&&(this._display.textContent=e),this._display.classList.add("opacity-60")}else{let t=e.map(e=>e.text).join(", ");this._maxSelections>0&&(t=`${t} (${this._selectedCount}/${this._maxSelections})`),this._display.textContent!==t&&(this._display.textContent=t),this._display.classList.remove("opacity-60")}}_renderChips(e){if(this._display.classList.remove("opacity-60"),0===e.length){this._display.innerHTML="";const e=document.createElement("span");return e.textContent=this._placeholder,e.className="opacity-60",void this._display.appendChild(e)}let t=this._display.querySelector(".chips-container");t||(this._display.innerHTML="",t=document.createElement("div"),t.className="chips-container flex flex-wrap gap-1 items-start w-full",t.style.contain="layout style",this._display.appendChild(t));const i=new Map;t.querySelectorAll("[data-item-key]").forEach(e=>{i.set(e.dataset.itemKey,e)});const s=new Set(e.map(e=>e.key)),n=document.createDocumentFragment(),o=[];i.forEach((e,t)=>{s.has(t)||o.push(e)}),e.forEach(({key:e,text:t})=>{if(!i.has(e)){const i=this._createChip(e,t);n.appendChild(i)}}),o.forEach(e=>e.remove()),n.hasChildNodes()&&t.appendChild(n)}_createChip(e,t){const i=document.createElement("div");return i.className=`badge ${this._getBadgeColorClass()} gap-0 ${this._getChipSizeClass()} flex items-center justify-center rounded-full ${this._disabled?"!px-3":"!px-0"}`,i.dataset.itemKey=e,this._disabled?i.innerHTML=`<span class="px-3">${this._escapeHtml(t)}</span>`:(this._removeSvgCache||(this._removeSvgCache='<svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>'),i.innerHTML=`\n            <span class="px-2">${this._escapeHtml(t)}</span>\n            <span class="w-px h-4 bg-current opacity-30"></span>\n            <button type="button" class="hover:opacity-75 transition-opacity cursor-pointer px-2" aria-label="Remove ${this._escapeHtml(t)}" data-chip-remove="${e}">\n              ${this._removeSvgCache}\n            </button>\n          `),i}_escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}_getChipSizeClass(){return{xs:"badge-xs",sm:"badge-sm",md:"badge-md",lg:"badge-lg",xl:"badge-lg"}[this._size]||"badge-md"}_getCheckboxColorClass(){return this._isHexColor?"":`checkbox-${this._color}`}_getBadgeColorClass(){let e=[];return this._isHexColor||e.push(`badge-${this._color}`),(this._isHexColor||this._chipTextColor)&&e.push(`badge-hex-${this._hexColorClass}`),e.join(" ")||`badge-${this._color}`}_removeChip(e){this._disabled||this._toggleSelection(e)}_updateBorderColor(){this._triggerBtn&&(this._triggerBtn.classList.remove("border-error","border-success"),this._required&&(this.isBlank()?this._triggerBtn.classList.add("border-error"):this._triggerBtn.classList.add("border-success")))}_dispatchChangeEvent(){const e=this._cachedSelectedItems.map(e=>e.value),t=e.join(this._delimiter),i=new CustomEvent("change",{detail:{values:e,valueString:t},bubbles:!0});this.dispatchEvent(i)}getSelectedValues(){const e=[];for(let t in this._keysSelected){const i=this._valueDict[t];i&&e.push(i.value)}return e}getSelectedTexts(){const e=[];for(let t in this._keysSelected){const i=this._valueDict[t];i&&e.push(i.text)}return e}clearSelected(){Object.keys(this._keysSelected||{}).forEach(e=>this._toggleSelection(e))}clear(){Object.values(this._valueDict).map(e=>e.value).forEach(e=>{this.removeOption(e)}),this._keysSelected={},this._selectedCount=0,this._selectedItemsDirty=!0,this._valueDict={},this._updateDisplay()}selectAll(){for(let e in this._valueDict)if(!this._valueDict[e].disabled&&!this._keysSelected[e]){if(this._maxSelections>0&&this._selectedCount>=this._maxSelections)break;this._toggleSelection(e)}}addOption(e,t,i=!1,s=!1,n={}){try{if("string"!=typeof e||""===e)return console.error("addOption: value must be a non-empty string"),!1;if("string"!=typeof t||""===t)return console.error("addOption: text must be a non-empty string"),!1;if(this._findKeyByValue(e))return console.warn(`Option with value "${e}" already exists`),!1;const o=document.createElement("option");o.value=e,o.textContent=t,o.selected=i,o.disabled=s,this._nativeSelect.appendChild(o);const l=document.createElement("li"),r="option-"+this._optionIdCounter++,a=this._nativeSelect.options.length-1;l.className="multiselect-option w-full "+(s?"disabled opacity-50":""),l.dataset.index=a,l.dataset.value=e,l.dataset.text=t.toLowerCase(),l.dataset.optionKey=r,l.setAttribute("role","option"),l.setAttribute("aria-selected",i?"true":"false"),s&&l.setAttribute("aria-disabled","true");const c=document.createElement("div");c.className=`flex items-center gap-3 cursor-pointer w-full ${this._getPaddingClass()} rounded ${s?"pointer-events-none":""}`;const h=document.createElement("input");h.type="checkbox",h.className=`checkbox ${this._getCheckboxColorClass()} ${this._getCheckboxSizeClass()} pointer-events-none`,h.checked=i,h.disabled=s;const d={value:e,text:t,selected:i,disabled:s,index:a,...n},u=this._renderOptionContent(d);c.appendChild(h);const p=document.createElement("div");for(p.innerHTML=u;p.firstChild;)c.appendChild(p.firstChild);l.appendChild(c);const _=this.querySelector(".multiselect-options-list");return _?(_.appendChild(l),this._valueDict[r]={value:e,text:t,selected:i,disabled:s,optionEl:l,nativeOption:o,...n},i&&(this._keysSelected[r]=!0,this._selectedCount++,this._selectedItemsDirty=!0,l.classList.add("selected"),this._highlight&&l.classList.add("highlight"),"primary"!==this._color&&l.classList.add(`color-${this._color}`)),this._options=this.querySelectorAll(".multiselect-option"),this._updateDisplay(),this._trigger("onOptionAdded",{key:r,text:t,value:e,selected:i,disabled:s,extraData:n}),!0):(console.error("addOption: options list not found"),!1)}catch(e){return this._handleError(e,"addOption"),!1}}enableItem(e,t){try{if(!e)return!1;if("boolean"!=typeof t)return console.warn("enableItem: varBoolean must be a boolean (true to enable, false to disable)"),!1;let i=e;if(!this._valueDict[i]&&(i=this._findKeyByValue(String(e)),!i))return console.warn(`enableItem: item '${e}' not found`),!1;const s=this._valueDict[i];if(!s)return!1;const n=t;if(s.disabled=!n,s.nativeOption&&(s.nativeOption.disabled=!n),s.optionEl){n?(s.optionEl.classList.remove("disabled","opacity-50"),s.optionEl.removeAttribute("aria-disabled")):(s.optionEl.classList.add("disabled","opacity-50"),s.optionEl.setAttribute("aria-disabled","true"));const e=s.optionEl.querySelector('input[type="checkbox"]');e&&(e.disabled=!n)}if(!n&&this._keysSelected&&this._keysSelected[i]){delete this._keysSelected[i],"number"==typeof this._selectedCount&&this._selectedCount>0?this._selectedCount--:this._selectedCount=0,s.selected=!1,s.nativeOption&&(s.nativeOption.selected=!1);const e=s.optionEl?s.optionEl.querySelector('input[type="checkbox"]'):null;e&&(e.checked=!1),s.optionEl&&(s.optionEl.setAttribute("aria-selected","false"),s.optionEl.classList.remove("selected","highlight",`color-${this._color}`)),this._selectedItemsDirty=!0}return"function"==typeof this._updateDisplay&&this._updateDisplay(),"function"==typeof this._trigger&&this._trigger("onOptionUpdated",{key:i,value:s.value,disabled:!n}),!0}catch(e){return"function"==typeof this._handleError&&this._handleError(e,"enableItem"),!1}}addOptions(e,t={}){try{if(!this._nativeSelect)try{this._setupComponent()}catch(e){console.warn("addOptions: component not initialized, setup failed",e)}if(!this._nativeSelect)return console.error("addOptions: native select not initialized"),0;if(!Array.isArray(e))return console.error("addOptions: items must be an array"),0;if(0===e.length)return 0;const i=t.valueField||this._valueField,s=t.textField||this._textField,n=t.selectedField||this._selectedField,o=void 0!==t.disabledField?t.disabledField:this._disabledField,l=t.extraDataFields||this._extraDataFields,r=[],a=document.createDocumentFragment(),c=document.createDocumentFragment();let h=!1;for(let t=0;t<e.length;t++){const d=e[t],u=d[i],p=d[s],_=n&&d[n]||!1,m=o&&d[o]||!1;if("string"!=typeof u||""===u){console.warn(`addOptions: Skipping item at index ${t} - invalid value field`);continue}if("string"!=typeof p||""===p){console.warn(`addOptions: Skipping item at index ${t} - invalid text field`);continue}if(this._findKeyByValue(u)){console.warn(`addOptions: Skipping item at index ${t} - value "${u}" already exists`);continue}const g={};l&&l.length>0&&l.forEach(e=>{d.hasOwnProperty(e)&&(g[e]=d[e])});const y=document.createElement("option");y.value=u,y.textContent=p,y.selected=_,y.disabled=m;const b=document.createElement("li"),v="option-"+this._optionIdCounter++,f=this._nativeSelect.options.length+r.length;b.className="multiselect-option w-full "+(m?"disabled opacity-50":""),b.dataset.index=f,b.dataset.value=u,b.dataset.text=p.toLowerCase(),b.dataset.optionKey=v,b.setAttribute("role","option"),b.setAttribute("aria-selected",_?"true":"false"),m&&b.setAttribute("aria-disabled","true");const x=document.createElement("div");x.className=`flex items-center gap-3 cursor-pointer w-full ${this._getPaddingClass()} rounded ${m?"pointer-events-none":""}`;const C=document.createElement("input");C.type="checkbox",C.className=`checkbox ${this._getCheckboxColorClass()} ${this._getCheckboxSizeClass()} pointer-events-none`,C.checked=_,C.disabled=m;const S={value:u,text:p,selected:_,disabled:m,index:f,...g},k=this._renderOptionContent(S);x.appendChild(C);const w=document.createElement("div");for(w.innerHTML=k;w.firstChild;)x.appendChild(w.firstChild);b.appendChild(x),a.appendChild(b),c.appendChild(y),r.push({key:v,value:u,text:p,selected:_,disabled:m,li:b,nativeOption:y,checkbox:C,extraData:g}),_&&(h=!0)}const d=this.querySelector(".multiselect-options-list");return d?(this._nativeSelect.appendChild(c),d.appendChild(a),r.forEach(({key:e,value:t,text:i,selected:s,disabled:n,li:o,nativeOption:l,checkbox:r,extraData:a})=>{this._valueDict[e]={value:t,text:i,selected:s,disabled:n,optionEl:o,nativeOption:l,checkbox:r,...a},s&&(this._keysSelected[e]=!0,o.classList.add("selected"),this._highlight&&o.classList.add("highlight"),"primary"!==this._color&&o.classList.add(`color-${this._color}`))}),this._updateOptionsCache(),this._updateDisplay(),r.length):(console.error("addOptions: options list not found"),0)}catch(e){return this._handleError(e,"addOptions"),0}}addOptionsMap(e,t={}){try{if(!e||"object"!=typeof e)return console.error("addOptionsMap: varMap must be an object"),0;const i=[];for(const[t,s]of Object.entries(e))if("string"==typeof s)i.push({[this._valueField]:t,[this._textField]:s});else{if(!s||"object"!=typeof s){console.warn(`addOptionsMap: Skipping entry for value ${t} - unsupported type`);continue}{const e=Object.assign({},s);e.hasOwnProperty(this._valueField)||(e[this._valueField]=t),e.hasOwnProperty(this._textField)||(e[this._textField]=String(e[this._textField]||t)),i.push(e)}}return 0===i.length?0:this.addOptions(i,t)}catch(e){return this._handleError(e,"addOptionsMap"),0}}removeOption(e){try{const t=this._findKeyByValue(e);if(!t)return console.warn(`Option with value "${e}" not found`),!1;const i=this._valueDict[t];return i.optionEl.remove(),i.nativeOption.remove(),this._keysSelected[t]&&(delete this._keysSelected[t],this._selectedCount--,this._selectedItemsDirty=!0),delete this._valueDict[t],this._updateOptionsCache(),this._updateDisplay(),this._trigger("onOptionRemoved",{key:t,value:e,text:i.text}),!0}catch(e){return this._handleError(e,"removeOption"),!1}}selectByValue(e){const t=this._findKeyByValue(e);return t?(this._keysSelected[t]||this._toggleSelection(t),!0):(console.warn(`Option with value "${e}" not found`),!1)}deselectByValue(e){const t=this._findKeyByValue(e);return t?(this._keysSelected[t]&&this._toggleSelection(t),!0):(console.warn(`Option with value "${e}" not found`),!1)}selectByIndex(e){const t=this.querySelectorAll(".multiselect-option");if(e<0||e>=t.length)return console.warn(`Option at index ${e} not found`),!1;const i=t[e].dataset.optionKey;return this._valueDict[i]?this._valueDict[i].disabled?(console.warn(`Option at index ${e} is disabled`),!1):(this._keysSelected[i]||this._toggleSelection(i),!0):(console.warn(`Option at index ${e} not found in dictionary`),!1)}deselectByIndex(e){const t=this.querySelectorAll(".multiselect-option");if(e<0||e>=t.length)return console.warn(`Option at index ${e} not found`),!1;const i=t[e].dataset.optionKey;return this._valueDict[i]?(this._keysSelected[i]&&this._toggleSelection(i),!0):(console.warn(`Option at index ${e} not found in dictionary`),!1)}hasOption(e){return null!==this._findKeyByValue(e)}getAllOptions(){return Object.entries(this._valueDict).map(([e,t])=>({key:e,value:t.value,text:t.text,selected:!!this._keysSelected[e],disabled:!!t.disabled}))}open(){try{if(!this._isOpen&&!this._disabled&&this._dropdown&&this._caret&&this._triggerBtn){this._closeOtherDropdowns(),this._isOpen=!0,this._dropdown.classList.remove("hidden"),this._caret.style.transform="rotate(180deg)",this._positionDropdown(),this._triggerBtn.setAttribute("aria-expanded","true");const e=new CustomEvent("open",{bubbles:!0,cancelable:!1});this.dispatchEvent(e)}}catch(e){this._handleError(e,"open")}}_closeOtherDropdowns(){document.querySelectorAll("daisy-multiselect").forEach(e=>{e!==this&&e.isOpen()&&e.close()})}close(){try{if(this._isOpen&&this._dropdown&&this._caret&&this._triggerBtn){this._isOpen=!1,this._dropdown.classList.add("hidden"),this._caret.style.transform="rotate(0deg)",this._triggerBtn.setAttribute("aria-expanded","false");const e=new CustomEvent("close",{bubbles:!0,cancelable:!1});this.dispatchEvent(e)}}catch(e){this._handleError(e,"close")}}toggle(){this._isOpen?this.close():this.open()}isOpen(){return this._isOpen}configure(e){try{if(!e||"object"!=typeof e)return void console.error("configure: options must be an object");if(e.customRenderer){if("function"!=typeof e.customRenderer)return void console.error("configure: customRenderer must be a function");this._log("Setting custom renderer"),this._customRenderer=e.customRenderer,this._reRenderAllOptions()}if(void 0!==e.valueField){if("string"!=typeof e.valueField)return void console.error("configure: valueField must be a string");this._valueField=e.valueField}if(void 0!==e.textField){if("string"!=typeof e.textField)return void console.error("configure: textField must be a string");this._textField=e.textField}if(void 0!==e.selectedField){if("string"!=typeof e.selectedField&&null!==e.selectedField)return void console.error("configure: selectedField must be a string or null");this._selectedField=e.selectedField}if(void 0!==e.disabledField){if("string"!=typeof e.disabledField&&null!==e.disabledField)return void console.error("configure: disabledField must be a string or null");this._disabledField=e.disabledField}if(void 0!==e.extraDataFields){if(!Array.isArray(e.extraDataFields))return void console.error("configure: extraDataFields must be an array");this._extraDataFields=e.extraDataFields}}catch(e){this._handleError(e,"configure")}}_updateRenderer(e){null===e||"function"==typeof e?this._customRenderer!==e?(this._log("Updating custom renderer"),this._customRenderer=e,e?this._reRenderAllOptions():this._updateOptionsCache()):this._log("Renderer unchanged, skipping update"):console.error("updateRenderer: renderer must be a function or null")}_removeRenderer(){this._updateRenderer(null)}_getRenderer(){return this._customRenderer||null}on(e,t){this._hooks[e]?"function"==typeof t?(this._hooks[e].push(t),this._log(`Registered callback for ${e}`)):console.error("[MultiSelect] Callback must be a function"):console.warn(`[MultiSelect] Unknown event: ${e}. Available: ${Object.keys(this._hooks).join(", ")}`)}off(e,t){if(!this._hooks[e])return;const i=this._hooks[e].indexOf(t);i>-1&&(this._hooks[e].splice(i,1),this._log(`Removed callback for ${e}`))}_trigger(e,t={}){this._hooks[e]&&(this._log(`Triggering ${e} with ${this._hooks[e].length} callbacks`),this._hooks[e].forEach(i=>{try{i({component:this,...t})}catch(t){console.error(`[MultiSelect] Error in ${e} callback:`,t)}}))}get enabled(){return!this._disabled}set enabled(e){if(!!e){this._disabled=!1,this.removeAttribute("disabled"),this._triggerBtn.disabled=!1,this._applyUserAttributes();const e=this.querySelector(".multiselect-clear-btn");e&&this._showClear&&e.classList.remove("hidden")}else{this._disabled=!0,this.setAttribute("disabled",""),this._triggerBtn.disabled=!0,this._applyUserAttributes(),this._isOpen&&this.close();const e=this.querySelector(".multiselect-clear-btn");e&&e.classList.add("hidden")}}get visible(){return"none"!==this.style.display}set visible(e){!!e?this.style.display="":(this.style.display="none",this._isOpen&&this.close())}isBlank(){return 0===this._selectedCount}get required(){return this._required}set required(e){this._required=!!e,this._required?this.setAttribute("required",""):this.removeAttribute("required"),this._updateBorderColor()}get value(){return this.getSelectedValues()}set value(e){this.clearSelected();let t=[];Array.isArray(e)?t=e:"string"==typeof e&&(t=e.split(this._delimiter).map(e=>e.trim()).filter(e=>e)),t.forEach(e=>{this.selectByValue(e)})}get delimiter(){return this._delimiter}set delimiter(e){"string"==typeof e&&e.length>0?(this._delimiter=e,this.setAttribute("delimiter",e)):console.warn("delimiter must be a non-empty string")}get checkedColor(){return this._color}set checkedColor(e){"string"==typeof e&&e.length>0?(this._color=e,this.setAttribute("checked-color",e),this._applyCheckedColorToOptions(),this._applyUserAttributes()):console.warn("checkedColor must be a non-empty string")}get borderColor(){if(!this._triggerBtn)return null;const e=["error","success","primary","secondary","accent","info","warning","neutral"];for(const t of e)if(this._triggerBtn.classList.contains(`border-${t}`))return t;return this._triggerBtn.style.borderColor||null}set borderColor(e){if(!this._triggerBtn)return;const t=["error","success","primary","secondary","accent","info","warning","neutral"];t.forEach(e=>{this._triggerBtn.classList.remove(`border-${e}`)}),this._triggerBtn.style.borderColor="",e&&(t.includes(e)?this._triggerBtn.classList.add(`border-${e}`):(/^#([0-9A-Fa-f]{3}|[0-9A-Fa-f]{6})$/.test(e),this._triggerBtn.style.borderColor=e))}get chipStyle(){return this._chipStyle}set chipStyle(e){const t=!!e;t!==this._chipStyle&&(this._chipStyle=t,this._chipStyle?this.setAttribute("chip-style",""):this.removeAttribute("chip-style"),this._updateDisplay())}_findKeyByValue(e){for(let t in this._valueDict)if(this._valueDict[t].value===e)return t;return null}_updateOptionsCache(){this._options=this.querySelectorAll(".multiselect-option"),this._log(`Options cache updated: ${this._options.length} options`)}_reRenderAllOptions(){if(this._log("Re-rendering all options with custom renderer..."),this._updateOptionsCache(),this._trigger("onRenderStart",{optionCount:this._options.length}),!this._customRenderer)return void this._log("No custom renderer set, skipping re-render");let e=0,t=0;this._options.forEach((i,s)=>{try{const n=i.dataset.optionKey;if(!n||!this._valueDict[n])return void this._log(`Option ${s} missing key or data, skipping`);const o=this._valueDict[n],l=i.querySelector("div.flex.items-center");if(!l)return console.error(`[MultiSelect] Option ${s} (${n}) missing container div`),void t++;const r=l.querySelector('input[type="checkbox"]');if(!r)return console.error(`[MultiSelect] Option ${s} (${n}) missing checkbox`),void t++;const a=[];let c;l.childNodes.forEach(e=>{e!==r&&a.push(e)}),a.forEach(e=>{try{l.removeChild(e)}catch(e){console.warn(`[MultiSelect] Error removing node from option ${n}:`,e)}});try{if(c=this._renderOptionContent(o),"string"!=typeof c)throw new Error("Custom renderer must return a string, got "+typeof c);if(!c.trim())throw new Error("Custom renderer returned empty string")}catch(e){console.error(`[MultiSelect] Custom renderer error for option "${n}":`,e),c=`<span class="${this._getTextSizeClass()}">${this._escapeHtml(o.text)}</span>`,i.classList.add("multiselect-render-error"),i.title=`Rendering error: ${e.message}`,t++}try{const t=document.createElement("div");if(t.innerHTML=c,!t.firstChild)throw new Error("Generated HTML produced no DOM nodes");for(;t.firstChild;)l.appendChild(t.firstChild);e++}catch(e){console.error(`[MultiSelect] Error inserting content for option "${n}":`,e);const i=document.createElement("span");i.className=this._getTextSizeClass(),i.textContent=o.text,l.appendChild(i),t++}}catch(e){console.error(`[MultiSelect] Unexpected error processing option ${s}:`,e),t++}}),this._log(`Re-render complete: ${e} succeeded, ${t} failed`),t>0&&console.warn(`[MultiSelect] ${t} options failed to render correctly`),this._trigger("onRenderComplete",{optionCount:this._options.length,successCount:e,errorCount:t})}_refreshOptions(){this._customRenderer?this._reRenderAllOptions():this._updateOptionsCache()}_filterOptions(e){const t=e.toLowerCase().trim(),i=(this.querySelector(".multiselect-options-list"),this.querySelector(".multiselect-no-results"));let s=0;const n=this._virtualScrollEnabled;""!==t&&this._disableVirtualScroll(),this._options.forEach(e=>{e.dataset.text.includes(t)?(e.style.display="",s++):e.style.display="none"}),""===t&&n&&this._enableVirtualScroll(),0===s?i.classList.remove("hidden"):i.classList.add("hidden")}_navigateOptions(e){const t=Array.from(this._options).filter(e=>"none"!==e.style.display&&!e.classList.contains("disabled"));if(0===t.length)return;let i=t.findIndex(e=>e.classList.contains("focused"));i>=0&&t[i].classList.remove("focused"),i=-1===i?e>0?0:t.length-1:(i+e+t.length)%t.length;const s=t[i];s.classList.add("focused"),s.scrollIntoView({block:"nearest",behavior:"smooth"})}_selectFocusedOption(){const e=Array.from(this._options).find(e=>e.classList.contains("focused"));if(e){const t=e.dataset.optionKey;this._toggleSelection(t)}}_scheduleMaxSelectionsUpdate(){this._maxSelectionsUpdatePending||(this._maxSelectionsUpdatePending=!0,requestAnimationFrame(()=>{this._maxSelectionsUpdatePending=!1,this._updateMaxSelectionsState()}))}_updateMaxSelectionsState(){if(this._maxSelections<=0)return;const e=this._selectedCount>=this._maxSelections;document.createDocumentFragment();this._options.forEach(t=>{const i=t.dataset.optionKey,s=this._keysSelected[i],n=this._valueDict[i];if(n&&!n.disabled&&!s){const i=t.classList;e?i.add("opacity-50","pointer-events-none"):i.remove("opacity-50","pointer-events-none")}})}destroy(){try{this._removeEventHandlers(),this._keysSelected=null,this._valueDict=null,this._allOptions=null,this._checkboxCache=null,this._hexColorStyleElement&&this._hexColorStyleElement.parentNode&&(this._hexColorStyleElement.remove(),this._hexColorStyleElement=null),this._triggerBtn=null,this._dropdown=null,this._display=null,this._caret=null,this._nativeSelect=null,this._options=null,this._statusElement=null,this._toggleBound=null,this._optionClickBound=null,this._keydownBound=null,this._virtualScrollBound=null,this._removeSvgCache=null,this._updateDisplayPending=!1;try{this._abortController=null}catch(e){}}catch(e){console.warn("Warning: error during destroy()",e)}finally{try{this.innerHTML=""}catch(e){}this._destroyed=!0}}}customElements.define("daisy-multiselect",DaisyMultiSelect);