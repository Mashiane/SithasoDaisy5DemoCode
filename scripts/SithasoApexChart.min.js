class SithasoApexChart extends HTMLElement{constructor(){super(),this.chart=null,this._data=null,this._options={},this._isLoading=!1,this._seriesMap=new Map,this._categories=[],this._colors=[]}connectedCallback(){this.checkApexCharts(),this.render()}disconnectedCallback(){if(this.chart)try{this.chart.destroy()}catch(t){console.warn("Error destroying chart during disconnection:",t)}}checkApexCharts(){return"undefined"!=typeof ApexCharts||(console.error('ApexCharts is not loaded. Please include: <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>'),this.showError("ApexCharts library not found. Please load ApexCharts first."),!1)}showError(t){this.innerHTML=`<div style="color: red; padding: 20px; text-align: center; border: 1px solid #ffcccc; background: #fff5f5;">${t}</div>`}updateLoadingState(){this._isLoading?(this.style.opacity="0.6",this.style.pointerEvents="none"):(this.style.opacity="1",this.style.pointerEvents="auto")}get borderRadius(){const t=this.getAttribute("border-radius"),e=parseInt(t,10);return!isNaN(e)&&e>=0?e:4}get xAxisOutputFormat(){const t=(this.getAttribute("x-axis-output-format")||"normal").toString();return["money","thousand","normal","date","datetime","time"].includes(t)?t:"normal"}get yAxisOutputFormat(){const t=(this.getAttribute("y-axis-output-format")||"normal").toString();return["money","thousand","normal","date","datetime","time"].includes(t)?t:"normal"}_formatValueForAxis(t,e){if(!e||"normal"===e)return t;if("money"===e||"thousand"===e){const a=Number(t);return isNaN(a)?t:"money"===e?new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(a):new Intl.NumberFormat("en-US",{maximumFractionDigits:0}).format(a)}if("date"===e||"datetime"===e){let a=null;if(a="number"==typeof t?new Date(t):"string"==typeof t&&/^[0-9]+$/.test(t)?new Date(Number(t)):new Date(t),isNaN(a.getTime()))return t;const r=t=>String(t).padStart(2,"0"),s=a.getFullYear(),i=r(a.getMonth()+1),o=r(a.getDate());if("date"===e)return`${s}-${i}-${o}`;const n=r(a.getHours()),l=r(a.getMinutes());return`${s}-${i}-${o} ${n}:${l}`}if("time"===e){let e=null;if(e="number"==typeof t?new Date(t):"string"==typeof t&&/^[0-9]+$/.test(t)?new Date(Number(t)):new Date(t),isNaN(e.getTime()))return t;const a=t=>String(t).padStart(2,"0"),r=a(e.getHours()),s=a(e.getMinutes());return`${r}:${s}`}return t}_applyAxisOutputFormats(t){try{const e=this.xAxisOutputFormat,a=this.yAxisOutputFormat;t&&e&&"normal"!==e&&(t.xaxis=t.xaxis||{},t.xaxis.labels=t.xaxis.labels||{},void 0===t.xaxis.labels.formatter&&(t.xaxis.labels.formatter=(t=>this._formatValueForAxis(t,e)))),t&&a&&"normal"!==a&&(Array.isArray(t.yaxis)?t.yaxis=t.yaxis.map(t=>(t=t||{},t.labels=t.labels||{},void 0===t.labels.formatter&&(t.labels.formatter=(t=>this._formatValueForAxis(t,a))),t)):(t.yaxis=t.yaxis||{},t.yaxis.labels=t.yaxis.labels||{},void 0===t.yaxis.labels.formatter&&(t.yaxis.labels.formatter=(t=>this._formatValueForAxis(t,a)))))}catch(t){console.warn("Failed to apply axis output formats",t)}}async render(){if(!this.checkApexCharts())return;this.innerHTML="";const t=document.createElement("div");t.style.height=this.getAttribute("height")||"300px",t.style.width=this.getAttribute("width")||"100%",t.style.transition="opacity 0.3s ease";const e=this.mapChartType(this.getAttribute("type")||"line");"bar"!==e&&"column"!==e||null!==this.getAttribute("force-rounded-stacks")||this.setAttribute("force-rounded-stacks","true"),t.style.overflow="pie"===e||"donut"===e||"radialBar"===e?"visible":"hidden",t.style.position="relative",this.appendChild(t),await this.createChart(t),this.updateLoadingState()}async createChart(t){const e=this.getAttribute("type")||"line",a=this.mapChartType(e);switch(a){case"line":await this.createLineChart(t);break;case"area":await this.createAreaChart(t);break;case"column":await this.createColumnChart(t);break;case"bar":await this.createBarChart(t);break;case"pie":await this.createPieChart(t);break;case"donut":await this.createDonutChart(t);break;case"radialBar":await this.createRadialBarChart(t);break;case"polarArea":await this.createPolarAreaChart(t);break;case"rangeArea":await this.createRangeAreaChart(t);break;case"radar":await this.createRadarChart(t);break;case"scatter":await this.createScatterChart(t);break;default:return void this.showError(`Chart type "${e}" is not supported yet`)}}getBaseDefaultOptions(t="line"){["line","area","bar","scatter"].includes(t),["pie","donut","radialBar"].includes(t);const e="false"!==this.getAttribute("grid-show"),a="false"!==this.getAttribute("tooltip-enabled"),r="false"!==this.getAttribute("show-legend"),s=this.getAttribute("legend-position")||"bottom",i=this.getAttribute("title")||"",o=this.getAttribute("title-font-size")||"14px",n=this.getAttribute("subtitle")||"",l=this.getAttribute("subtitle-font-size")||"12px",h="false"!==this.getAttribute("show-toolbar"),c=this.showDataLabels,u=this.getAttribute("x-axis-title")||"",p=this.getAttribute("y-axis-title")||"",d=this.getAttribute("curve")||"smooth",b=parseInt(this.getAttribute("line-width"),10)||2,g=this.markerSize,A="true"===this.getAttribute("sparkline");let y=c;const m="true"===this.getAttribute("realtime");m&&(y=!1);const f={show:r,position:s,horizontalAlign:"center",verticalAlign:"top"===s?"top":"bottom",floating:!1,offsetX:0,offsetY:0,labels:{colors:"#333",useSeriesColors:!1},formatter:function(t,e){return t||"Series"}},x={text:n,align:"left",style:{fontSize:l,color:"#333"}},O={text:i,align:"left",style:{fontSize:o,color:"#333"}},w={chart:{toolbar:{show:h},height:parseInt(this.getAttribute("height"))||350,animations:{enabled:!0},fontFamily:"inherit",zoom:{enabled:!1},sparkline:{enabled:A}},title:O,subtitle:x,legend:f,tooltip:{enabled:a,shared:!0,followCursor:!0,intersect:!1,x:{show:!0},y:{show:!0}},dataLabels:{enabled:c},stroke:{curve:d,width:b},markers:{size:g,strokeColors:"#fff",strokeWidth:2},responsive:[{breakpoint:480,options:{chart:{height:250},legend:{position:"bottom",horizontalAlign:"center",verticalAlign:"bottom",offsetX:0,offsetY:0}}}]},S=this.getAttribute("x-axis-offsety");return w.xaxis={tooltip:{enabled:!1},labels:{show:!0},position:"bottom",title:{text:u,style:{fontSize:"14px",color:"#333"},offsetY:S?parseInt(S):2}},w.yaxis={tooltip:{enabled:!1},labels:{show:!0},title:{text:p,style:{fontSize:"14px",color:"#333"}}},w.grid={show:e,borderColor:"#e7e7e7",strokeDashArray:3,xaxis:{lines:{show:!0}},yaxis:{lines:{show:!0}},padding:{top:10,right:20,bottom:10,left:10}},"true"===this.getAttribute("realtime")&&(w.chart.animations={enabled:!0,easing:"linear",dynamicAnimation:{speed:1e3}},w.chart.zoom.enabled=!1,w.markers.size=0,w.dataLabels.enabled=y),"false"!==this.getAttribute("gradient")&&(w.fill={type:"gradient"}),w}set options(t){this._options={...this._options,...t},this.chart&&this.chart.updateOptions(this._options)}get options(){const t=this.getAttribute("options");return t?this.parseOptions(t):this._options}get markerSize(){const t=this.getAttribute("marker-size");return t?parseInt(t,10):6}get gridShow(){const t=this.getAttribute("grid-show");return null===t?null:"true"===t}set gridShow(t){!0===t||"true"===t?this.setAttribute("grid-show","true"):this.setAttribute("grid-show","false")}get tooltipEnabled(){const t=this.getAttribute("tooltip-enabled");return null===t?null:"true"===t}set tooltipEnabled(t){!0===t||"true"===t?this.setAttribute("tooltip-enabled","true"):this.setAttribute("tooltip-enabled","false")}get sparkline(){return"true"===this.getAttribute("sparkline")}set sparkline(t){!0===t||"true"===t?this.setAttribute("sparkline","true"):this.removeAttribute("sparkline")}get columnWidth(){const t=this.getAttribute("column-width");return t?t.toString():null}get barLabels(){const t=this.getAttribute("bar-labels");return"true"===t}get startAngle(){const t=this.getAttribute("start-angle"),e=parseInt(t,10);return isNaN(e)?0:e}get endAngle(){const t=this.getAttribute("end-angle"),e=parseInt(t,10);return isNaN(e)?360:e}get typeOf(){return this.getAttribute("type")}set typeOf(t){this.setAttribute("type",t)}get data(){return this.parseData(this.getAttribute("data"))}set data(t){const e=JSON.stringify(t);this.setAttribute("data",e)}get height(){return this.getAttribute("height")}set height(t){this.setAttribute("height",t)}get width(){return this.getAttribute("width")}set width(t){this.setAttribute("width",t)}get theme(){return this.getAttribute("theme")}set theme(t){this.setAttribute("theme",t)}get loading(){return this.getAttribute("loading")}set loading(t){this.setAttribute("loading",t)}get showLegend(){return this.getAttribute("show-legend")}set showLegend(t){this.setAttribute("show-legend",t)}get legendPosition(){return this.getAttribute("legend-position")}set legendPosition(t){this.setAttribute("legend-position",t)}get showToolbar(){return this.getAttribute("show-toolbar")}set showToolbar(t){this.setAttribute("show-toolbar",t)}get title(){return this.getAttribute("title")}set title(t){this.setAttribute("title",t)}get subtitle(){return this.getAttribute("subtitle")}set subtitle(t){null==t?this.removeAttribute("subtitle"):this.setAttribute("subtitle",t)}get subtitleFontSize(){return this.getAttribute("subtitle-font-size")||"12px"}set subtitleFontSize(t){null==t?this.removeAttribute("subtitle-font-size"):this.setAttribute("subtitle-font-size",t)}get titleFontSize(){return this.getAttribute("title-font-size")||"14px"}set titleFontSize(t){null==t?this.removeAttribute("title-font-size"):this.setAttribute("title-font-size",t)}get showDataLabels(){return this.hasAttribute("show-data-labels")&&"false"!==this.getAttribute("show-data-labels")}set showDataLabels(t){!1===t||"false"===t||null==t?this.removeAttribute("show-data-labels"):this.setAttribute("show-data-labels","true")}get xAxisTitle(){return this.getAttribute("x-axis-title")}set xAxisTitle(t){this.setAttribute("x-axis-title",t)}get yAxisTitle(){return this.getAttribute("y-axis-title")}set yAxisTitle(t){this.setAttribute("y-axis-title",t)}get dataLabelOrientation(){return this.getAttribute("data-label-orientation")}set dataLabelOrientation(t){null==t?this.removeAttribute("data-label-orientation"):this.setAttribute("data-label-orientation",t)}get dataLabelPosition(){return this.getAttribute("data-label-position")}set dataLabelPosition(t){null==t?this.removeAttribute("data-label-position"):this.setAttribute("data-label-position",t)}get curve(){return this.getAttribute("curve")}set curve(t){this.setAttribute("curve",t)}get lineWidth(){return this.getAttribute("line-width")}set lineWidth(t){this.setAttribute("line-width",t)}get categories(){const t=this.getAttribute("categories");try{return t?JSON.parse(t):[]}catch{return[]}}set categories(t){this.setAttribute("categories",JSON.stringify(t))}get donutShowTotal(){return this.getAttribute("donut-show-total")}set donutShowTotal(t){this.setAttribute("donut-show-total",t)}get hollowSize(){return this.getAttribute("hollow-size")}set hollowSize(t){this.setAttribute("hollow-size",t)}get dashedRadial(){return this.getAttribute("dashed-radial")}set dashedRadial(t){this.setAttribute("dashed-radial",t)}get trackWidth(){return this.getAttribute("track-width")}set trackWidth(t){this.setAttribute("track-width",t)}get bar(){return this.getAttribute("bar")}set bar(t){this.setAttribute("bar",t)}get xAxisOffsetY(){return this.getAttribute("x-axis-offsety")}set xAxisOffsetY(t){this.setAttribute("x-axis-offsety",t)}get xAxisLabelRotate(){return this.getAttribute("x-axis-label-rotate")}set xAxisLabelRotate(t){this.setAttribute("x-axis-label-rotate",t)}get xAxisLabelRotateOffsetY(){return this.getAttribute("x-axis-label-rotate-offsety")}set xAxisLabelRotateOffsetY(t){this.setAttribute("x-axis-label-rotate-offsety",t)}get gradient(){return this.getAttribute("gradient")}set gradient(t){this.setAttribute("gradient",t)}get realtime(){return this.getAttribute("realtime")}set realtime(t){this.setAttribute("realtime",t)}get stacked(){return"true"===this.getAttribute("stacked")}set stacked(t){this.setAttribute("stacked",t?"true":"false")}validateChartData(t){return!(!t||"object"==typeof t&&0===Object.keys(t).length)||(this.showError("No data provided for chart"),!1)}formatLineSeries(t){return this.formatGenericSeries(t,"line")}formatAreaSeries(t){return this.formatGenericSeries(t,"area")}formatBarSeries(t){return this.formatGenericSeries(t,"bar")}formatPieSeries(t){return Array.isArray(t)?t.length>0&&"object"==typeof t[0]&&t[0].name?t.map(t=>t.data):Array.isArray(t[0])&&2===t[0].length?t.map(t=>t[1]):t:"object"==typeof t?Object.values(t):[]}formatDonutSeries(t){return this.formatPieSeries(t)}formatRadialBarSeries(t){return this.formatPieSeries(t)}formatScatterSeries(t){return this.formatGenericSeries(t,"scatter")}formatGenericSeries(t,e){return Array.isArray(t)?t.length>0&&"object"==typeof t[0]&&t[0].name?t.map(t=>({name:t.name,data:this.formatSingleSeries(t.data,e),color:t.color,dashed:t.dashed||!1})):[{name:"Series 1",data:this.formatSingleSeries(t,e)}]:"object"==typeof t?[{name:"Series 1",data:this.formatSingleSeries(t,e)}]:[]}async createLineChart(t){const e=this.parseData(this.getAttribute("data")),a=this.parseOptions(this.getAttribute("options"));if(!this.validateChartData(e))return;const r=this.formatLineSeries(e),s=this.showDataLabels,i=this.getAttribute("categories")||"[]";let o=s;const n="true"===this.getAttribute("realtime");n&&(o=!1);const l={...this.getBaseDefaultOptions("line"),chart:{...this.getBaseDefaultOptions("line").chart,type:"line"},...a};a&&a.xaxis&&(l.xaxis={...this.getBaseDefaultOptions("line").xaxis,...a.xaxis}),a&&a.yaxis&&(l.yaxis={...this.getBaseDefaultOptions("line").yaxis,...a.yaxis});const h=this.getAttribute("x-axis-label-rotate");if(h&&0!==parseInt(h)&&(l.xaxis={...l.xaxis,position:"bottom",labels:{...l.xaxis?l.xaxis.labels:void 0,rotate:parseInt(h),rotateAlways:!0,offsetY:parseInt(this.getAttribute("x-axis-label-rotate-offsety"))||25}}),i)try{const t=JSON.parse(i);l.xaxis={...l.xaxis,categories:t}}catch(t){console.warn("Invalid categories format:",i)}const c=r.map(t=>!0===t.dashed?5:0);l.stroke={...l.stroke,dashArray:c};try{l.plotOptions=l.plotOptions||{},l.plotOptions.bar=l.plotOptions.bar||{},void 0===l.plotOptions.bar.borderRadius&&(l.plotOptions.bar.borderRadius=4),this.columnWidth&&(l.plotOptions.bar.columnWidth=this.columnWidth)}catch(t){}try{let t=null;try{t=i?JSON.parse(i):null}catch(e){t=null}Array.isArray(t)&&t.length>0&&(l.xaxis={...l.xaxis||{},categories:t})}catch(t){}try{const t=Array.isArray(r)?r.map(t=>t&&t.color).filter(Boolean):[];t.length>0&&(!l.colors||0===l.colors.length)&&(l.colors=t,l.legend&&l.legend.labels&&(l.legend.labels.useSeriesColors=!0))}catch(t){}try{try{this._applyAxisOutputFormats(l)}catch(t){}this.hasAttribute("data-label-orientation")&&(l.plotOptions=l.plotOptions||{},l.plotOptions.bar=l.plotOptions.bar||{},l.plotOptions.bar.dataLabels=l.plotOptions.bar.dataLabels||{},l.plotOptions.bar.dataLabels.orientation=this.getAttribute("data-label-orientation")),this.hasAttribute("data-label-position")&&(l.plotOptions=l.plotOptions||{},l.plotOptions.bar=l.plotOptions.bar||{},l.plotOptions.bar.dataLabels=l.plotOptions.bar.dataLabels||{},l.plotOptions.bar.dataLabels.position=this.getAttribute("data-label-position")),this.chart=new ApexCharts(t,{...l,series:r}),await this.chart.render(),this._options=l}catch(t){console.error("Error creating line chart:",t),this.showError("Error creating line chart: "+t.message)}}async createAreaChart(t){const e=this.parseData(this.getAttribute("data")),a=this.parseOptions(this.getAttribute("options"));if(!this.validateChartData(e))return;const r=this.formatAreaSeries(e),s=this.showDataLabels,i=this.getAttribute("categories")||"[]";let o=s;const n="true"===this.getAttribute("realtime");n&&(o=!1);const l={...this.getBaseDefaultOptions("area"),chart:{...this.getBaseDefaultOptions("area").chart,type:"area",animations:{enabled:!0}},...a};if(a&&a.xaxis&&(l.xaxis={...this.getBaseDefaultOptions("area").xaxis,...a.xaxis}),a&&a.yaxis&&(l.yaxis={...this.getBaseDefaultOptions("area").yaxis,...a.yaxis}),this.sparkline)try{l.chart=l.chart||{},l.chart.sparkline={enabled:!0}}catch(t){}"true"===this.getAttribute("stacked")&&(l.chart={...l.chart,stacked:!0});const h=this.getAttribute("x-axis-label-rotate");if(h&&0!==parseInt(h)&&(l.xaxis={...l.xaxis,position:"bottom",labels:{...l.xaxis?l.xaxis.labels:void 0,rotate:parseInt(h),rotateAlways:!0,offsetY:parseInt(this.getAttribute("x-axis-label-rotate-offsety"))||25}}),i)try{const t=JSON.parse(i);l.xaxis={...l.xaxis,categories:t}}catch(t){console.warn("Invalid categories format:",i)}try{try{this._applyAxisOutputFormats(l)}catch(t){}this.chart=new ApexCharts(t,{...l,series:r}),await this.chart.render(),this._options=l}catch(t){console.error("Error creating area chart:",t),this.showError("Error creating area chart: "+t.message)}}async createColumnChart(t){const e=this.parseData(this.getAttribute("data")),a=this.parseOptions(this.getAttribute("options"));if(!this.validateChartData(e))return;const r=this.formatBarSeries(e),s=this.showDataLabels,i=!1,o=this.getAttribute("categories")||"[]";let n=s;const l="true"===this.getAttribute("realtime");l&&(n=!1);const h={...this.getBaseDefaultOptions("column"),series:r,chart:{...this.getBaseDefaultOptions("column").chart,type:"bar"},plotOptions:{bar:{horizontal:i,borderRadius:this.borderRadius,borderRadiusApplication:"around",borderRadiusWhenStacked:"all"}},...a};a&&a.xaxis&&(h.xaxis={...this.getBaseDefaultOptions("column").xaxis,...a.xaxis}),a&&a.yaxis&&(h.yaxis={...this.getBaseDefaultOptions("column").yaxis,...a.yaxis}),"true"===this.getAttribute("stacked")&&(h.chart={...h.chart,stacked:!0},h.plotOptions={...h.plotOptions,bar:{...h.plotOptions&&h.plotOptions.bar||{},borderRadiusWhenStacked:"last",borderRadius:this.borderRadius,borderRadiusApplication:"end"}});const c=this.getAttribute("x-axis-label-rotate");if(c&&0!==parseInt(c)&&(h.xaxis={...h.xaxis,position:"bottom",labels:{...h.xaxis?h.xaxis.labels:void 0,rotate:parseInt(c),rotateAlways:!0,offsetY:parseInt(this.getAttribute("x-axis-label-rotate-offsety"))||25}}),o)try{const t=JSON.parse(o);h.xaxis={...h.xaxis,categories:t}}catch(t){console.warn("Invalid categories format:",o)}try{const t=Array.isArray(r)?r.map(t=>t&&t.color).filter(Boolean):[];t.length>0&&(!h.colors||0===h.colors.length)&&(h.colors=t,h.legend&&h.legend.labels&&(h.legend.labels.useSeriesColors=!0))}catch(t){}try{try{this._applyAxisOutputFormats(h)}catch(t){}this.hasAttribute("data-label-orientation")&&(h.plotOptions=h.plotOptions||{},h.plotOptions.bar=h.plotOptions.bar||{},h.plotOptions.bar.dataLabels=h.plotOptions.bar.dataLabels||{},h.plotOptions.bar.dataLabels.orientation=this.getAttribute("data-label-orientation")),this.hasAttribute("data-label-position")&&(h.plotOptions=h.plotOptions||{},h.plotOptions.bar=h.plotOptions.bar||{},h.plotOptions.bar.dataLabels=h.plotOptions.bar.dataLabels||{},h.plotOptions.bar.dataLabels.position=this.getAttribute("data-label-position"));try{this.columnWidth&&(h.plotOptions=h.plotOptions||{},h.plotOptions.bar=h.plotOptions.bar||{},h.plotOptions.bar.columnWidth=this.columnWidth)}catch(t){}this.chart=new ApexCharts(t,h),await this.chart.render(),this._options=h}catch(t){console.error("Error creating column chart:",t),this.showError("Error creating column chart: "+t.message)}}async createBarChart(t){const e=this.parseData(this.getAttribute("data")),a=this.parseOptions(this.getAttribute("options"));if(!this.validateChartData(e))return;const r=this.formatBarSeries(e),s=this.showDataLabels,i=this.getAttribute("x-axis-title")||"",o=this.getAttribute("y-axis-title")||"",n=this.getAttribute("categories")||"[]",l=this.getAttribute("data-label-position")||"center";let h=s;const c="true"===this.getAttribute("realtime");c&&(h=!1);const u={...this.getBaseDefaultOptions("bar"),series:r,chart:{...this.getBaseDefaultOptions("bar").chart,type:"bar"},plotOptions:{bar:{borderRadius:this.borderRadius,borderRadiusApplication:"around",horizontal:!0,borderRadiusWhenStacked:"all"}},dataLabels:{enabled:h,textAnchor:"middle",style:{colors:["#fff"],fontSize:"12px"},formatter:function(t){return t.toString()},offsetX:"center"===l?0:30,dropShadow:{enabled:!1}},xaxis:(()=>{const t=this.getAttribute("x-axis-offsety"),e=this.getAttribute("x-axis-label-rotate"),a={title:{text:i||"",style:{fontSize:"14px",color:"#333"},offsetY:t?parseInt(t):2}};return e&&0!==parseInt(e)&&(a.position="bottom",a.labels={rotate:parseInt(e),rotateAlways:!0,offsetY:parseInt(this.getAttribute("x-axis-label-rotate-offsety"))||25}),a.labels={...a.labels||{},show:!0},a})(),yaxis:{title:{text:o||"",style:{fontSize:"14px",color:"#333"}},labels:{show:!0}},...a};try{u.plotOptions=u.plotOptions||{},u.plotOptions.bar=u.plotOptions.bar||{},void 0===u.plotOptions.bar.borderRadius&&(u.plotOptions.bar.borderRadius=4),this.columnWidth&&(u.plotOptions.bar.columnWidth=this.columnWidth)}catch(t){}try{const t=Array.isArray(r)?r.map(t=>t&&t.color).filter(Boolean):[];t.length>0&&(!u.colors||0===u.colors.length)&&(u.colors=t,u.legend&&u.legend.labels&&(u.legend.labels.useSeriesColors=!0))}catch(t){}"true"===this.getAttribute("stacked")&&(u.chart={...u.chart,stacked:!0},u.plotOptions={...u.plotOptions,bar:{...u.plotOptions&&u.plotOptions.bar||{},borderRadiusWhenStacked:"last",borderRadius:this.borderRadius,borderRadiusApplication:"end"}});try{const t=n?JSON.parse(n):null;Array.isArray(t)&&t.length>0&&(u.yaxis={...u.yaxis||{},categories:t},u.xaxis={...u.xaxis||{},categories:t})}catch(t){}try{try{this._applyAxisOutputFormats(u)}catch(t){}try{this.columnWidth&&(u.plotOptions=u.plotOptions||{},u.plotOptions.bar=u.plotOptions.bar||{},u.plotOptions.bar.columnWidth=this.columnWidth)}catch(t){}this.chart=new ApexCharts(t,u),await this.chart.render(),this._options=u}catch(t){console.error("Error creating bar chart:",t),this.showError("Error creating bar chart: "+t.message)}}async createPieChart(t){const e=this.parseData(this.getAttribute("data")),a=this.parseOptions(this.getAttribute("options"));if(!this.validateChartData(e))return;const r=this.formatPieSeries(e),s=this.showDataLabels;let i=s;const o="true"===this.getAttribute("realtime");o&&(i=!1);const n={...this.getBaseDefaultOptions("pie"),chart:{...this.getBaseDefaultOptions("pie").chart,type:"pie"},...a};Array.isArray(e)&&e.length>0&&(e.length>0&&"object"==typeof e[0]&&e[0].name?(n.labels=e.map(t=>t.name),n.colors=e.map(t=>t.color).filter(t=>t)):Array.isArray(e[0])&&2===e[0].length?n.labels=e.map(t=>t[0]):"object"==typeof e&&(n.labels=Object.keys(e)));try{try{this._applyAxisOutputFormats(n)}catch(t){}this.chart=new ApexCharts(t,{...n,series:r}),await this.chart.render(),this._options=n}catch(t){console.error("Error creating pie chart:",t),this.showError("Error creating pie chart: "+t.message)}}async createDonutChart(t){const e=this.parseData(this.getAttribute("data")),a=this.parseOptions(this.getAttribute("options"));if(!this.validateChartData(e))return;const r=this.formatDonutSeries(e),s=this.showDataLabels,i="false"!==this.getAttribute("donut-show-total");let o=s;const n="true"===this.getAttribute("realtime");n&&(o=!1);const l={...this.getBaseDefaultOptions("donut"),chart:{...this.getBaseDefaultOptions("donut").chart,type:"donut"},plotOptions:{pie:{donut:{labels:{show:s,total:{show:i}}}}},...a};Array.isArray(e)&&e.length>0&&(e.length>0&&"object"==typeof e[0]&&e[0].name?(l.labels=e.map(t=>t.name),l.colors=e.map(t=>t.color).filter(t=>t)):Array.isArray(e[0])&&2===e[0].length?l.labels=e.map(t=>t[0]):"object"==typeof e&&(l.labels=Object.keys(e)));try{try{this._applyAxisOutputFormats(l)}catch(t){}this.chart=new ApexCharts(t,{...l,series:r}),await this.chart.render(),this._options=l}catch(t){console.error("Error creating donut chart:",t),this.showError("Error creating donut chart: "+t.message)}}async createRadialBarChart(t){const e=this.parseData(this.getAttribute("data")),a=this.parseOptions(this.getAttribute("options"));if(!this.validateChartData(e))return;const r=this.formatRadialBarSeries(e),s=this.showDataLabels,i=this.getAttribute("hollow-size")||"50%",o="true"===this.getAttribute("dashed-radial"),n=this.getAttribute("track-width")||"97%";let l=s;const h="true"===this.getAttribute("realtime");h&&(l=!1);const c={...this.getBaseDefaultOptions("radialBar"),chart:{...this.getBaseDefaultOptions("radialBar").chart,type:"radialBar"},stroke:{lineCap:"round"},plotOptions:{radialBar:{hollow:{size:i},track:{strokeWidth:n},startAngle:this.startAngle,endAngle:this.endAngle,barLabels:{enabled:!0===this.barLabels,useSeriesColors:!0,offsetX:-40,fontSize:"14px",formatter:function(t,e){return t+":  "+(e&&e.w&&e.w.globals&&e.w.globals.series?e.w.globals.series[e.seriesIndex]:"")}}}},...o&&{stroke:{dashArray:4}},dataLabels:{enabled:l,formatter:function(t){return t+"%"},style:{fontSize:"14px",colors:["#fff"]}},...a};Array.isArray(e)&&e.length>0&&(e.length>0&&"object"==typeof e[0]&&e[0].name?(c.labels=e.map(t=>t.name),c.colors=e.map(t=>t.color).filter(t=>t)):Array.isArray(e[0])&&2===e[0].length?c.labels=e.map(t=>t[0]):"object"==typeof e&&(c.labels=Object.keys(e)));try{try{this._applyAxisOutputFormats(c)}catch(t){}this.chart=new ApexCharts(t,{...c,series:r}),await this.chart.render(),this._options=c}catch(t){console.error("Error creating radial bar chart:",t),this.showError("Error creating radial bar chart: "+t.message)}}async createScatterChart(t){const e=this.parseData(this.getAttribute("data")),a=this.parseOptions(this.getAttribute("options"));if(!this.validateChartData(e))return;const r=this.formatScatterSeries(e),s=this.showDataLabels,i=this.getAttribute("categories")||"[]";let o=s;const n="true"===this.getAttribute("realtime");n&&(o=!1);const l={...this.getBaseDefaultOptions("scatter"),chart:{...this.getBaseDefaultOptions("scatter").chart,type:"scatter",zoom:{enabled:!0,type:"xy"}},xaxis:{...this.getBaseDefaultOptions("scatter").xaxis,tickAmount:10,labels:{formatter:function(t){return parseFloat(t).toFixed(1)}}},yaxis:{...this.getBaseDefaultOptions("scatter").yaxis,tickAmount:7},...a};a&&a.xaxis&&(l.xaxis={...l.xaxis,...a.xaxis}),a&&a.yaxis&&(l.yaxis={...l.yaxis,...a.yaxis});const h=this.getAttribute("x-axis-label-rotate");if(h&&0!==parseInt(h)&&(l.xaxis={...l.xaxis,position:"bottom",labels:{...l.xaxis?l.xaxis.labels:void 0,rotate:parseInt(h),rotateAlways:!0,offsetY:parseInt(this.getAttribute("x-axis-label-rotate-offsety"))||25}}),i)try{const t=JSON.parse(i);l.xaxis={...l.xaxis,categories:t}}catch(t){console.warn("Invalid categories format:",t)}try{try{this._applyAxisOutputFormats(l)}catch(t){}this.chart=new ApexCharts(t,{...l,series:r}),await this.chart.render(),this._options=l}catch(t){console.error("Error creating scatter chart:",t),this.showError("Error creating scatter chart: "+t.message)}}async createRadarChart(t){const e=this.parseData(this.getAttribute("data")),a=this.parseOptions(this.getAttribute("options"));if(!this.validateChartData(e))return;let r=this.categories||[],s=null;if(Array.isArray(e)&&e.length>0&&"object"==typeof e[0]&&e[0].name&&e[0].data&&"object"==typeof e[0].data&&!Array.isArray(e[0].data)){const t=Object.keys(e[0].data);(!r||0===r.length)&&t.length>0&&(r=t.slice()),s=e.map(t=>({name:t.name||"Series",data:Array.isArray(t.data)?t.data.slice():Object.values(t.data)}))}else!Array.isArray(e)&&e&&"object"==typeof e?(r=Object.keys(e),s=[{name:this.getAttribute("title")||"Series 1",data:Object.values(e)}]):s=this.formatSeries(e,"radar");const i=s,o=this.showDataLabels,n=r||[];let l=o;"true"===this.getAttribute("realtime")&&(l=!1);let h={...this.getBaseDefaultOptions("radar"),chart:{...this.getBaseDefaultOptions("radar").chart,type:"radar"},dropShadow:{enabled:!0,blur:1,left:1,top:1},fill:{opacity:.1},xaxis:{categories:n},yaxis:{stepSize:20}};h.grid=h.grid||{},null===this.gridShow?h.grid.show=!1:h.grid.show=this.gridShow,h=this.deepMerge(h,a||{}),h.chart={...h.chart||{},...a&&a.chart?a.chart:{},type:"radar"};try{const t=Array.isArray(i)?i.map(t=>t&&t.color).filter(Boolean):[];t.length>0&&(!h.colors||0===h.colors.length)&&(h.colors=t,h.legend&&h.legend.labels&&(h.legend.labels.useSeriesColors=!0))}catch(t){}try{try{this._applyAxisOutputFormats(h)}catch(t){}this.chart=new ApexCharts(t,{...h,series:i}),await this.chart.render(),this._options=h}catch(t){console.error("Error creating radar chart:",t),this.showError("Error creating radar chart: "+t.message)}}async createPolarAreaChart(t){const e=this.parseData(this.getAttribute("data")),a=this.parseOptions(this.getAttribute("options"));if(!this.validateChartData(e))return;let r=null,s=e;!Array.isArray(e)&&e&&"object"==typeof e&&(r=Object.keys(e),s=Object.values(e));const i=this.formatPieSeries(s);let o=[];const n=this.categories;if(o=Array.isArray(n)&&n.length>0?n.slice():r&&r.length>0?r.slice():Array.isArray(s)&&s.length>0?"object"==typeof s[0]&&s[0].name?s.map(t=>t.name):Array.isArray(s[0])&&s[0].length>=2?s.map(t=>t[0]):i.map((t,e)=>`Item ${e+1}`):i.map((t,e)=>`Item ${e+1}`),Array.isArray(i))for(o.length>i.length&&(o=o.slice(0,i.length));o.length<i.length;)o.push(`Item ${o.length+1}`);try{if(Array.isArray(i)&&i.length>1){const t=i.map((t,a)=>({value:t,label:o[a]||`Item ${a+1}`,color:Array.isArray(e)&&"object"==typeof e[a]?e[a].color:null}));t.sort((t,e)=>e.value-t.value),i=t.map(t=>t.value),o=t.map(t=>t.label);const a=t.map(t=>t.color).filter(Boolean);if(a.length>0&&!h)var l=a}}catch(t){}let h=null;const c=this.getAttribute("colors");if(c)try{const t=JSON.parse(c);Array.isArray(t)&&t.length>0&&(h=t)}catch(t){console.warn("Invalid colors attribute format:",c)}this.showDataLabels;let u={...this.getBaseDefaultOptions("polarArea"),chart:{...this.getBaseDefaultOptions("polarArea").chart,type:"polarArea"},series:i,labels:o,plotOptions:{polarArea:{rings:{strokeWidth:1}}}};if(u=this.deepMerge(u,a||{}),!h||u.colors&&0!==u.colors.length||(u.colors=h),u.chart={...u.chart||{},...a&&a.chart?a.chart:{},type:"polarArea"},Array.isArray(s)&&s.length>0&&"object"==typeof s[0]&&s[0].name){const t=s.map(t=>t.color).filter(Boolean),e=void 0!==l&&l.length>0?l:t;e&&e.length>0&&(!u.colors||0===u.colors.length)&&(u.colors=e)}try{try{this._applyAxisOutputFormats(u)}catch(t){}this.chart=new ApexCharts(t,{...u,series:i}),await this.chart.render(),this._options=u}catch(t){console.error("Error creating polar area chart:",t),this.showError("Error creating polar area chart: "+t.message)}}async createRangeAreaChart(t){const e=this.parseData(this.getAttribute("data")),a=this.parseOptions(this.getAttribute("options"));if(!this.validateChartData(e))return;const r=this.formatAreaSeries(e),s=this.showDataLabels,i=this.getAttribute("categories")||"[]";let o=s;const n="true"===this.getAttribute("realtime");n&&(o=!1);const l={...this.getBaseDefaultOptions("area"),chart:{...this.getBaseDefaultOptions("area").chart,type:"rangeArea"},...a};if(a&&a.xaxis&&(l.xaxis={...this.getBaseDefaultOptions("area").xaxis,...a.xaxis}),a&&a.yaxis&&(l.yaxis={...this.getBaseDefaultOptions("area").yaxis,...a.yaxis}),i)try{const t=JSON.parse(i);l.xaxis={...l.xaxis||{},categories:t}}catch(t){console.warn("Invalid categories format:",i)}try{try{this._applyAxisOutputFormats(l)}catch(t){}this.chart=new ApexCharts(t,{...l,series:r}),await this.chart.render(),this._options=l}catch(t){console.error("Error creating range area chart:",t),this.showError("Error creating range area chart: "+t.message)}}async updateChart(){if(this.chart){try{this.chart.destroy()}catch(t){console.warn("Error destroying chart during update:",t)}this.chart=null}try{this.innerHTML=""}catch(t){}await this.render()}parseData(t){if(!t)return[{data:[]}];try{return JSON.parse(t)}catch(e){return console.warn("Invalid data format:",t),[{data:[]}]}}parseOptions(t){if(!t)return{};try{return JSON.parse(t)}catch(e){return console.warn("Invalid options format:",t),{}}}mapChartType(t){const e={line:"line",area:"area",column:"column",bar:"bar",pie:"pie",donut:"donut",radialBar:"radialBar",scatter:"scatter",bubble:"bubble",heatmap:"heatmap",treemap:"treemap",radar:"radar",polarArea:"polarArea",
rangeBar:"rangeBar",rangeArea:"rangeArea",candlestick:"candlestick",boxPlot:"boxPlot"};return e[t]||"line"}formatSeries(t,e){const a=this.mapChartType(e);return Array.isArray(t)?t.length>0&&"object"==typeof t[0]&&t[0].name?t.map(t=>({name:t.name,data:this.formatSingleSeries(t.data,a),color:t.color,dashed:t.dashed||!1})):"pie"===a||"donut"===a||"radialBar"===a?Array.isArray(t[0])&&2===t[0].length?t.map(t=>t[1]):t:[{name:"Series 1",data:this.formatSingleSeries(t,a)}]:"object"==typeof t?[{name:"Series 1",data:this.formatSingleSeries(t,a)}]:[]}isPlainObject(t){return t&&"object"==typeof t&&t.constructor===Object}deepMerge(t,e){if(!e)return t;if(Array.isArray(e))return e.slice();const a=Array.isArray(t)?t.slice():{...t};return Object.keys(e).forEach(t=>{const r=e[t],s=a[t];this.isPlainObject(r)&&this.isPlainObject(s)?a[t]=this.deepMerge(s,r):a[t]=r}),a}formatSingleSeries(t,e){return Array.isArray(t)?"pie"===e||"donut"===e||"radialBar"===e?t.map(t=>"number"==typeof t?t:t[1]):t.length>0&&Array.isArray(t[0])?t.map(t=>({x:t[0],y:t[1]})):t:"object"==typeof t?"pie"===e||"donut"===e||"radialBar"===e?Object.values(t):Object.entries(t).map(([t,e])=>({x:t,y:e})):[]}async updateData(t){const e=this.parseData(JSON.stringify(t)),a=this.getAttribute("type")||"line",r=this.formatSeries(e,a);if(this.chart)try{return void await this.chart.updateSeries(r)}catch(t){console.error("Error updating chart series via updateData:",t)}this.setAttribute("data",JSON.stringify(t))}async updateOptions(t){const e=this.parseOptions(this.getAttribute("options")),a=this.deepMerge(e,t);if(this.chart)try{return await this.chart.updateOptions(a),void this.setAttribute("options",JSON.stringify(a))}catch(t){console.error("Error updating chart options via updateOptions:",t)}this.setAttribute("options",JSON.stringify(a))}getChart(){return this.chart}_setAttributeInternal(t,e){null==e?this.removeAttribute(t):this.setAttribute(t,e)}_removeAttributeInternal(t){this.removeAttribute(t)}setLoading(t){t?this.setAttribute("loading",""):this.removeAttribute("loading")}addEventListener(t,e,a){super.addEventListener(t,e,a)}clear(){if(this.chart){try{this.chart.destroy()}catch(t){}this.chart=null}this._data=null;try{this._seriesMap.clear()}catch(t){}this._categories=[],this._colors=[];try{this._removeAttributeInternal("data")}catch(t){}try{this._removeAttributeInternal("categories")}catch(t){}try{this._removeAttributeInternal("colors")}catch(t){}try{this.innerHTML=""}catch(t){console.warn("Error clearing chart during clear():",t)}}addSeries(t,e,a){const r=this._seriesMap.get(t)||{},s={name:t,data:a,color:e||r.color||null,dashed:void 0!==r.dashed&&r.dashed};this._seriesMap.set(t,s)}addSeriesPoint(t,e,a){let r=null;if(r="object"==typeof e&&null!==e?Array.isArray(e)&&e.length>=2?{x:e[0],y:e[1]}:void 0!==e.x||void 0!==e.y?{x:e.x,y:e.y}:e:void 0!==a?{x:e,y:a}:e,!this._seriesMap.has(t)){const e={name:t,data:[],color:null};this._seriesMap.set(t,e)}const s=this._seriesMap.get(t);Array.isArray(s.data)||(void 0!==s.data&&null!==s.data?s.data=[s.data]:s.data=[]),s.data.push(r),this._seriesMap.set(t,s)}addSeriesAppendValue(t,e){if(!this._seriesMap.has(t))return void this._seriesMap.set(t,{name:t,data:[e],color:null,dashed:!1});const a=this._seriesMap.get(t);Array.isArray(a.data)||(a.data=[a.data]),a.data.push(e),this._seriesMap.set(t,a)}addSeriesColor(t,e){const a=this._seriesMap.get(t)||{},r={name:t,data:a.data||[],color:e,dashed:void 0!==a.dashed&&a.dashed};this._seriesMap.set(t,r)}addCategory(t){this._categories.push(t);for(const[t,e]of this._seriesMap){for(Array.isArray(e.data)||(e.data=[e.data||""]);e.data.length<this._categories.length;)e.data.push("");this._seriesMap.set(t,e)}}addColor(t){null!=t&&this._colors.push(t)}addSeriesValue(t,e){const a=this._seriesMap.get(t)||{},r={name:t,data:e,color:a.color||null,dashed:void 0!==a.dashed&&a.dashed};this._seriesMap.set(t,r)}addXY(t,e){this.addSeriesValue(t,e)}SetSeriesColor(t,e){if(this._seriesMap.has(t)){const a=this._seriesMap.get(t);a.color=e,this._seriesMap.set(t,a)}}SetSeriesDashed(t,e){const a=!0===e||"true"===e;if(!this._seriesMap.has(t))return void this._seriesMap.set(t,{name:t,data:[],color:null,dashed:a});const r=this._seriesMap.get(t);r.dashed=a,this._seriesMap.set(t,r)}addSeriesCategoryValue(t,e,a){let r=[];if(!this._seriesMap.has(t)){r=[];for(let t=0;t<this._categories.length;t++)r.push("");const e={name:t,data:r};this._seriesMap.set(t,e)}const s=this._seriesMap.get(t);r=s.data;const i=this._categories.indexOf(e);-1!==i&&(r[i]=a,s.data=r,this._seriesMap.set(t,s))}_buildRuntimeState(t){const e=this.mapChartType(t||this.getAttribute("type")||"line");if("pie"===e||"donut"===e||"radialBar"===e||"polarArea"===e){const t=Array.from(this._seriesMap.values()).map(t=>({name:t.name,data:Array.isArray(t.data)?t.data[0]:t.data,color:t.color})),e=t.map(t=>t.data||0),a=t.map(t=>t.name),r=t.map(t=>t.color).filter(Boolean),s=t.map(t=>({name:t.name,data:t.data,color:t.color}));return{pieSeries:e,pieLabels:a,pieColors:r,dataAttr:s}}const a=Array.from(this._seriesMap.values()).map(t=>{const e=Array.isArray(t.data)?t.data.slice():[t.data];return{name:t.name,data:e,color:t.color,dashed:!!t.dashed}}),r=a,s=Array.isArray(this._categories)?this._categories.slice():[],i=Array.isArray(this._colors)?this._colors.slice():[];return{runtimeSeriesObjects:a,dataAttr:r,categories:s,colors:i}}async refresh(){try{const t=this.getAttribute("type")||"line",e=this._buildRuntimeState(t);try{e.dataAttr&&e.dataAttr.length>0?this._setAttributeInternal("data",JSON.stringify(e.dataAttr)):this._removeAttributeInternal("data")}catch(t){}try{e.categories&&e.categories.length>0?this._setAttributeInternal("categories",JSON.stringify(e.categories)):this._removeAttributeInternal("categories")}catch(t){}try{const t=e.runtimeSeriesObjects?e.runtimeSeriesObjects.map(t=>t&&t.color).filter(Boolean):[],a=e.colors&&e.colors.length>0?e.colors:[],r=t.length>0?t:a;r&&r.length>0?this._setAttributeInternal("colors",JSON.stringify(r)):this._removeAttributeInternal("colors")}catch(t){}return void await this.updateChart()}catch(t){console.error("Error during chart refresh:",t.message||t,t.stack||"no stack")}}addCategories(t){Array.isArray(t)&&this._categories.push(...t)}addColors(t){Array.isArray(t)&&this._colors.push(...t)}}const styleId="sithaso-apex-default-styles";if(!document.getElementById(styleId)){const t=document.createElement("style");t.id=styleId,t.textContent="\n    sithaso-apex {\n      display: block;\n      width: 100%;\n      max-width: 100%;\n      overflow: hidden;\n    }\n  ",document.head.appendChild(t)}customElements.define("sithaso-apex",SithasoApexChart);